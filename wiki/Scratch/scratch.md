# Обучающие программы по Scratch

## Установка программного обеспечения

### Установка Kidsblock

#### Установить Kidsblock в системе Windows

1. Вы можете скачать KidsBlock с сайта: 

   - Ссылка: [https://wiki.kidsbits.cc/projects/KidsBlock/en/latest/download/](https://wiki.kidsbits.cc/projects/KidsBlock/en/latest/download/)

   - Предоставленный файл: ![img](./scratch_img/an1-1.png)

     

2. После загрузки нажмите “KidsBlock.exe”![img](./scratch_img/an1.png)

3. Отметьте “**Все, кто использует этот компьютер (все пользователи)**” и нажмите “**Далее**”.

![img](./scratch_img/an2.png)

4. Нажмите “**Обзор...**”, чтобы выбрать путь для установки (здесь мы выбираем диск C; вы можете выбрать любое место, которое вам нравится), и нажмите “**Установить**”. Установка началась!


![img](./scratch_img/an3.png)

![img](./scratch_img/an4.png)

5. После завершения установки нажмите “**Готово**”, чтобы открыть ее.

![img](./scratch_img/an5.png)

6. Если появится предупреждение, пожалуйста, просто нажмите “**Разрешить доступ**”, чтобы перейти на главную страницу программного обеспечения.

![img](./scratch_img/an6.png)

------



#### Установить Kidsblock на macOS

1. Пожалуйста, сначала скачайте пакет Kidsblock: [https://wiki.kidsbits.cc/projects/KidsBlock/en/latest/download/](https://wiki.kidsbits.cc/projects/KidsBlock/en/latest/download/)

![img](./scratch_img/an7.png)

2. Нажмите KidsBlock и перетащите значок "Рабочий стол idsBlock" в "Приложения", как показано ниже.

![img](./scratch_img/an8.png)

3. После установки на панели управления появится значок детского блока:

   ![img](./scratch_img/an9.png).

4. Нажмите на значок KidsBlock, чтобы войти в программу. Если это не удается, измените некоторые настройки компьютера, чтобы повторно ввести ее. Это связано с тем, что системы Mac по умолчанию разрешают установку только в App Store, поэтому установка других приложений запрещена.

   ![img](././scratch_img/an9-1.png)

5. Откройте настройки и выберите Конфиденциальность и безопасность. Переключите параметр безопасности на “Магазин приложений и одобренные разработчики” и нажмите “Все еще открыто”.

   ![img](././scratch_img/an9-2.png)

6. Нажмите “Открыть”, чтобы повторно войти в заблокированное программное обеспечение.

   ![img](././scratch_img/an9-3.png)

7. После настройки он может работать в обычном режиме.

   ![img](././scratch_img/an9-4.png)

8. Интерфейс запуска выглядит следующим образом. Теперь наслаждайтесь своим путешествием в программировании!

   ![img](././scratch_img/an9-5.png)

------



### Руководство по программному обеспечению

(** Приведенные ниже демонстрации основаны на системе Windows и являются только ссылкой для macOS.**)

#### Функциональный раздел главной страницы 1

![img](./scratch_img/an10.png)



##### Выберите язык

Нажмите ![img](./scratch_img/an11.png), чтобы выбрать “Английский” или “简体中文" ![img](./scratch_img/an12.png)



##### Установить драйвер

**ПРИМЕЧАНИЕ: Если на вашем компьютере уже установлен драйвер, пожалуйста, просто пропустите этот раздел. Если нет, выполните следующие действия.**

- Нажмите ![img](./scratch_img/an13.png), чтобы выбрать “**Установить драйвер**”.


![img](./scratch_img/an14.png)

- Нажмите “**Далее**”, когда откроется мастер установки драйвера устройства:

![img](./scratch_img/an15.png)

- Нажмите “**Готово**”.

![img](./scratch_img/an16.png)

- Нажмите “**Далее**”.

![img](./scratch_img/an17.png)

- Нажмите ”**Завершить**".

![img](./scratch_img/an18.png)

- Если появится предупреждение, просто нажмите “**Разрешить**”. Затем нажмите “**Установить**”.

![img](./scratch_img/an19.png)

- Нажмите ”**Завершить**".

![img](./scratch_img/an20.png)

- Нажмите “**Извлечь**”.

![img](./scratch_img/an21.png)

- Нажмите “**Далее**”.

![img](./scratch_img/an22.png)

- Отметьте “**Я принимаю данное соглашение**” и нажмите “**Далее**”.

![img](./scratch_img/an23.png)

- Нажмите ”**Завершить**".

![img](./scratch_img/an24.png)

- Выберите “**УСТАНОВИТЬ**”.

![img](./scratch_img/an25.png)

- Через пару секунд драйвер будет успешно установлен. Затем нажмите “**OK**”.

![img](./scratch_img/an26.png)



##### Выберите устройства

###### Выберите устройство и последовательный порт

- Нажмите ![img](././scratch_img/an27.png), чтобы выбрать устройство. 

- Здесь мы вводим **Kit**, чтобы найти **Smart farm для ESP32** и добавить его. Обратите внимание, что все датчики входят в данный комплект, поэтому вам не нужно импортировать их дополнительно. 

  ![img](././scratch_img/an28.png)

- После импорта этого комплекта вы увидите следующий интерфейс выбора порта. Нажмите **Подключиться** к нужному порту.

  ![img](././scratch_img/an29.png)

- Нажмите **Перейти в редактор**.

  ![img](././scratch_img/an30.png)

- Главная страница:

  ![img](././scratch_img/an31.png)

###### Отключите устройство

- Если вы хотите отключить комплект и порт, пожалуйста, нажмите ![img](././scratch_img/an32.png).

- Затем нажмите **Отключить**, чтобы отменить текущее подключение. 

  ![img](././scratch_img/an33.png)
  
  

------



#### Функциональное распределение главной страницы 2

![img](././scratch_img/an34.png)



##### Расширение датчика/модуля

**ПРИМЕЧАНИЕ: Эту часть можно пропустить, так как все необходимые датчики встроены в комплект и их не нужно расширять. Если вы хотите использовать исключенный модуль, пожалуйста, ознакомьтесь со следующими процедурами.**

- Нажмите ![an42](././scratch_img/an35.png), чтобы перейти в библиотеку расширений датчиков/модулей.

- Выберите расширение.

  ![img](././scratch_img/an36.png)

- Например, если требуется модуль зуммера, пожалуйста, выберите пассивный зуммер.: 

- ![img](././scratch_img/an37.png)

- Когда “**Не загружено**” становится “**Загружено**”, этот модуль успешно импортируется.

  ![img](././scratch_img/an38.png)

- Нажмите ![img](././scratch_img/an39.png), чтобы вернуться в редактор. Теперь вы увидите, что в коде появился блок пассивного зуммера.

![img](././scratch_img/an41.png)

- Если вы хотите удалить “пассивный зуммер”, просто нажмите ![img](././scratch_img/an42.png), чтобы войти в библиотеку, и нажмите.

  ![img](././scratch_img/an38.png)

- Когда значение “Загружено” изменится на “Не загружено”, этот модуль будет успешно удален.

  ![img](././scratch_img/an37.png)

  

##### Импорт файла

- Способ 1

   - Если программа не работает, то непосредственно щелкните файл SB3, чтобы открыть его. Например, нажмите ![img](././scratch_img/an46.png), чтобы открыть его. Не забудьте выбрать устройство.

     ![img](././scratch_img/an54.png)

- Способ 2

   - Откройте Kidsblock. Нажмите “**файл**”, чтобы выбрать “**Загрузить с вашего компьютера**”.![img](././scratch_img/an47.png)	

   - Выберите файл SB3 (например ![img](././scratch_img/an46.png)).

     ![img](././scratch_img/an50.png)

   - Импорт выполнен успешно!
   
     ![img](././scratch_img/an54.png)
   



##### Код загрузки и установка скорости передачи данных

###### Код загрузки

- Загрузи файл ![img](././scratch_img/an47.png) в Kidsblock.

- Подключите плату разработки к компьютеру (если вы не видите порт, пожалуйста, сначала установите драйвер), выберите нужный порт и нажмите ![img](././scratch_img/an52.png).

  ![img](././scratch_img/an54.png)

- Дождаться загрузки.

  ![img](././scratch_img/an53.png)

###### Установить скорость передачи данных в бодах

- Если поля для печати нет, пожалуйста, нажмите на одно из ![img](././scratch_img/an56.png), чтобы изменить размер поля. 
  - Поле для печати небольшого размера![img](././scratch_img/an58.png)
  - Поле для печати крупным шрифтом![img](././scratch_img/an59.png)
  - Поле для печати отсутствует![img](././scratch_img/an60.png)

- Нажмите ![img](././scratch_img/an57.png), чтобы задать соответствующую скорость передачи данных в бодах.

![img](././scratch_img/an55.png)

- после установки в поле будет выводиться надпись “**Hello KidsBlock**”.


![img](././scratch_img/an62.png)

------

------

## Сборка

Во время сборки необходимо записать некоторые коды, поэтому, пожалуйста, сначала установите программное обеспечение. 

Обычно всю сборку можно разделить на две части: сборка деталей и проводов. 

------

### Шаг 1

#### 1.1 Необходимые компоненты

![img](./scratch_img/image001.png)

------

#### 1.2

![img](./scratch_img/image002.png)

------

#### 1.3

![img](./scratch_img/image003.png)

------

#### 1.4

![img](./scratch_img/image004.png)

------

#### 1.5

![img](./scratch_img/image006.png)

------



### Шаг 2

------

#### 2.1 Необходимые компоненты

![img](./scratch_img/image007.png)

------

#### 2.2

Прикрепите деревянную доску X и O к нижней пластине H

![img](./scratch_img/image008.png)

------

#### 2.3

![img](./scratch_img/image010.png)

------

#### 2.4

![img](./scratch_img/image011.png)

------

#### 2.5

![img](./scratch_img/image012.png)

------

#### 2.6

![img](./scratch_img/image013.png)

------

#### 2.7

![img](./scratch_img/image014.png)

------

#### 2.8 Подключение

| Модуль | Провод | Вывод |
| :----------: | :-------: | :--: |
| Релейный модуль | 3PIN 20 см | IO25 |

**Обратите внимание на цвет провода Dupont: для модуля реле подключите желтый к S, красный к V, черный к G.**

![img](./scratch_img/image015.png)

------

#### 2.9

![img](./scratch_img/image015-1.png)

------



### Шаг 3

------

#### 3.1 Необходимые компоненты

![img](./scratch_img/image016.png)

------

#### 3.2

![img](./scratch_img/image017.png)

------

#### 3.3

![img](./scratch_img/image018.png)

------

#### 3.4

![img](./scratch_img/image019.png)

------

#### 3.5

![img](./scratch_img/image020.png)

------

#### 3.6

![img](./scratch_img/image021.png)

------

#### 3.7

![img](./scratch_img/image022.png)

------

#### 3.8

![img](./scratch_img/image023.png)

------

#### 3.9

![img](./scratch_img/image024.png)

------

#### 3.10

![img](./scratch_img/image025.png)

------

#### 3.11

![img](./scratch_img/image026.png)

------


### Шаг 4

------

#### 4.1 Необходимые компоненты

![img](./scratch_img/image027.png)

------

#### 4.2 Установите сервопривод на 180°

**Перед установкой сервопривода, пожалуйста, сначала установите угол наклона на 180° с помощью программирования: Arduino (C++) или Scratch (графическое программирование).**

Пожалуйста, ознакомьтесь с инструкциями по установке программного обеспечения для получения подробной информации.



**Подключите сервопривод к плате разработки ESP32 по выводу IO26.**

![img](./scratch_img/image028-1.png)

------

![img](./scratch_img/image028-3.png)

------


- Открыть **Scratch 3.0**. Выберите плату ESP32 и правильный последовательный порт и запишите следующий код на плату.

  ![img](./scratch_img/image028-2.png)

**После установки сервопривода под определенным углом отсоедините его от платы разработки для установки.**

------

#### 4.3 Установка сервопривода

![img](./scratch_img/image029.png)

------

#### 4.4

![img](./scratch_img/image030.png)

------

#### 4.5

![img](./scratch_img/image031.png)

Не испортите механизм.
![img](./scratch_img/6e1caadec8b1ec99b0093200763607b6.jpg)

------

#### 4.6

![img](./scratch_img/image032.png)

------

#### 4.7

![img](./scratch_img/image033.png)

------

#### 4.8

![img](./scratch_img/image034.png)

------

#### 4.9 

**ПРИМЕЧАНИЕ: При установке крышки кормушки ее отверстие должно быть полностью закрыто.**

![img](./scratch_img/image035.png)

------

#### 4.10

![img](./scratch_img/image036.png)

------

#### 4.11

![img](./scratch_img/image037.png)

------

#### 4.12

![img](./scratch_img/image037-1.png)

------



### Шаг 5

------

#### 5.1 Необходимые компоненты

![img](./scratch_img/image038.png)

------

#### 5.2

![img](./scratch_img/image039.png)

------

#### 5.3

![img](./scratch_img/image040.png)

------

#### 5.4

![img](./scratch_img/image041.png)

------

### Прототип # 5.5

![img](./scratch_img/image042.png)

------

#### 5.6 Подключение

**Подключайте модули с помощью проводов Dupont.**

| Модуль | Провод /
| :-----------------------------: | :-----------------------------: |
| Датчик температуры и влажности | 3-контактный, 20 см |
| LCD 1602 | 4-контактный **(черный-красный-синий-зеленый)** |

**Обратите внимание на цвет провода Dupont:**

**Для датчика температуры и влажности подключите желтый к S, красный к V, черный к G.**

![img](./scratch_img/image043.png)

------

#### 5.7

**Для ЖК-дисплея подключите зеленый к SCL, синий к SDA, красный к VCC, черный к GND.**

![img](./scratch_img/image044.png)

------



### Шаг 6

------

#### 6.1 Необходимые компоненты.

![img](./scratch_img/image045.png)

------

#### 6.2

![img](./scratch_img/image046.png)

------

#### 6.3

![img](./scratch_img/image047.png)

------

#### 6.4 Подключение

| Модуль | Провод |
| :---------------: | :-----------------------------: |
| Ультразвуковой модуль | 4PIN ** (Черный-зеленый-Синий-красный)** |

**Обратите внимание на цвет провода Dupont: для ультразвукового модуля подключите синий к TRIG, зеленый к ECHO, красный к VCC, черный к GND.**

![img](./scratch_img/image048.png)

------

### Шаг 7

------

#### 7.1 Необходимые компоненты

![img](./scratch_img/image049.png)

------

#### 7.2

![img](./scratch_img/image050.png)

------

#### 7.3

![img](./scratch_img/image051.png)

------

#### 7.4 Подключение

**Подключайте модули с помощью проводов Dupont.**

| Модуль | Провод /
| :---------------: | :-------: |
| Датчик движения PIR | 3PIN 15 см |
|   Кнопочный модуль | 3PIN 15 см |

**Обратите внимание на цвет провода Dupont: желтый соедините с S, красный - с V, черный - с G.**

![img](./scratch_img/image052.png)

------



### Шаг 8

------

#### 8.1 Необходимые компоненты

![img](./scratch_img/image053.png)

------

#### 8.2

![img](./scratch_img/image054.png)

------

#### 8.3

![img](./scratch_img/image055.png)

------

#### 8.4

![img](./scratch_img/image056.png)

------

#### 8.5

![img](./scratch_img/image057.png)

------

#### 8.6

![img](./scratch_img/image058.png)

------

#### 8.7

![img](./scratch_img/image059.png)

------

### Прототип # 8.8

![img](./scratch_img/image060.png)

------

#### 8.9 Подключение

| Модуль | Провод |
| :-----------: | :-----------------------------: |
| Вентилятор | 4PIN **(Черный-красный-синий-зеленый)** |
| Датчик пара | 3PIN 15 см |
| Фоторезистор | 3PIN 15 см |

**Обратите внимание на цвет провода Dupont: желтый соедините с S, красный - с V, черный - с G, синий - с IN+, зеленый - с IN-.**

![img](./scratch_img/image061.png)

------

### Шаг 9

------

#### 9.1 Необходимые компоненты

![img](./scratch_img/image062.png)

------

#### 9.2

![img](./scratch_img/image063.png)

------

#### 9.3

![img](./scratch_img/image064.png)

------

#### 9.4 Подключение

![img](./scratch_img/image065.png)

------



### Шаг 10

------

#### 10.1 Необходимые компоненты

![img](./scratch_img/image066.png)

------

#### 10.2

![img](./scratch_img/image067.png)

------

#### 10.3

![img](./scratch_img/image068.png)

------

#### 10.4 Вид снизу

![img](./scratch_img/image069.png)

------

#### 10.5

![img](./scratch_img/image070.png)

------

#### 10.6

![img](./scratch_img/image071.png)

------

#### 10.7 

![img](./scratch_img/image072.png)

------



### Шаг 11 Подключение

------

#### 11.1 

**Обратите внимание на цвет провода Dupont: желтый соедините с S, красный - с V, черный - с G.**

| НОМЕР.  | Компоненты | Провода | Контакты платы ESP32 |
| :--: | :-----------------------------: | :------------------------------------: | :------------------------: |
| 1 | Вентилятор | 4-контактный, **Разделенный ** Черно-красно-сине-зеленый | io18(В-) \| io19(В+) |
| 2 | Датчик движения PIR | 3-контактный, 15 см | io23 |
| 3 | Кнопка | 3pin 15 см | io5 |
| 4 | Ультразвуковой модуль | 4pin,**Разделенный** Черно-зелено-сине-Красный |    D12(ТРИГГЕР) D13(ЭХО) |
| 5 | ЖК-дисплей 1602 | 4pin, **Подключен ** | I2C |
| 6 | Датчик температуры и влажности | 3pin 20 см | io17 |
| 7 | Датчик пара | 3pin 15 см | io35 |
| 8 | Фоторезистор | 3pin 15 см | io34 |
| 9 | Сервопривод | -- | io26 |
| 10 | Зуммер | 3pin 20 см | io16 |
| 11 | Светодиод | 3pin 20 см | io27 |
| 12 | Датчик уровня воды | 3pin 25 см | io33 |
| 13 | Датчик влажности почвы | 3pin 20 см | io32 |
| 14 | Водяной насос | 3pin 20 см | io25 |



#### 11.2 Вентилятор

| Компоненты | Провода | Контакты на плате ESP32 |
| :--------: | :-----------------------------------------: | :------------------: |
| Вентилятор | 4-контактный **Разделенный** **(Черный-красный-синий-зеленый)** | io18(В-), io19(В+) |

| Вывод модуля | Цвет провода /
| :--------: | :--------: |
| В- | ЗЕЛЕНЫЙ |
| IN+ | СИНИЙ |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |

![img](./scratch_img/image073.png)

------

#### 11.3 Датчик движения PIR

| Компонент | Провод | Вывод платы ESP32 |
| :---------------: | :-------: | :-------------: |
| Датчик движения PIR | 3PIN 15 см | io23 |

**Подключите красный к V, черный к G, желтый к S.**

| Контакт модуля / Цвет провода |
| :--------: | :--------: |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |
| S | ЖЕЛТЫЙ |

![img](./scratch_img/image074.png)

------

#### Модуль кнопок 11.4

| Компонент | Провод | Вывод платы ESP32 |
| :-------: | :-------: | :-------------: |
| Кнопка | 3-контактный разъем 15 см | io5 |

**Подключите красный к V, черный к G, желтый к S.**

| Контакт модуля / Цвет провода |
| :--------: | :--------: |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |
| S | ЖЕЛТЫЙ |

![img](./scratch_img/image075.png)

------

### Ультразвуковой модуль # 11.5  

| Компонент | Провод | Контакты платы ESP32 |
| :---------------: | :-----------------------------------------: | :--------------------: |
| Ультразвуковой модуль | 4PIN **Разделенный** ** (Черный-зеленый-синий-красный)** | io13 (ЭХО), io12 (ТРИГГЕР) |

**Подключите красный к V, черный к G, синий к io12, зеленый к io13.**

| Вывод модуля | Цвет провода |
| :--------: | :--------: |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |
| ЭХО | ЗЕЛЕНЫЙ |
| ТРИГОНОМЕТРИЯ | СИНИЙ |

![img](./scratch_img/image076.png)

------

#### 11.6 ЖК-дисплей 1602

| Компонент | Провод | Контакты платы ESP32 |
| :-------: | :-------------------------------------------: | :--------------: |
| ЖК-дисплей 1602 | 4PIN **Подключен** ** (Черный-красный-синий-зеленый)** | I2C |

**Подключите красный к V, черный к G, синий к SDA, зеленый к SCL.**

| Вывод модуля | Цвет провода |
| :--------: | :--------: |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |
| SCL | ЗЕЛЕНЫЙ |
| SDA | СИНИЙ |

![img](./scratch_img/image077.png)

------

#### 11.7 Датчик температуры и влажности  

| Компонент | Провод | Контакты платы ESP32 |
| :-----------------------------: | :-------: | :--------------: |
| Датчик температуры и влажности | 3PIN 20 см | io17 |

**Подключите красный к V, черный к G, желтый к io17.**

| Контакт модуля / Цвет провода |
| :--------: | :--------: |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |
| S | ЖЕЛТЫЙ |

![img](./scratch_img/image078.png)

------

#### 11.8 Датчик пара

| Компонент | Провод | Вывод на плате ESP32 |
| :----------: | :-------: | :-------------: |
| Датчик пара | 3PIN 15 см | io35 |

**Подключите красный к V, черный к G, желтый к io35.**

| Вывод модуля | Цвет провода |
| :--------: | :--------: |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |
| S | ЖЕЛТЫЙ |

![img](./scratch_img/image079.png)

------

#### 11.9 Фоторезистор

| Компонент | Провод | Вывод на плате ESP32 |
| :-----------: | :-------: | :-------------: |
| Фоторезистор | 3PIN 15 см | io34 |

**Подключите красный к V, черный к G, желтый к io34.**

| Вывод модуля | Цвет провода |
| :--------: | :--------: |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |
| S | ЖЕЛТЫЙ |

![img](./scratch_img/image080.png)

------

#### 11.10 Сервопривод

**Пропустите провод сервопривода через отверстие 15, а затем подсоедините его к плате ESP32.**

| Компонент | Провод | Вывод платы ESP32 |
| :-------: | :--: | :-------------: |
| Сервопривод | 3PIN | io26 |

**Подключите красный к разъему V, черный к разъему G, желтый к разъему io26.**

| Контакт платы | Цвет провода |
| :-------: | :--------: |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |
| IO26 | ЖЕЛТЫЙ |

![img](./scratch_img/image081.png)

------

#### 11.11 Звуковой сигнал

**Пропустите провод звукового сигнала через отверстие 17, а затем подключите его к плате ESP32.**

| Компонент | Провод | Вывод платы ESP32 |
| :-------: | :-------: | :-------------: |
| Зуммер | 3PIN 20 см | io16 |

**Подключите красный к V, черный к G, желтый к io16.**

| Вывод модуля | Цвет провода |
| :--------: | :--------: |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |
| S | ЖЕЛТЫЙ |

![img](./scratch_img/image082.png)

------

#### 11.12 СВЕТОДИОД

**Пропустите провод светодиода через отверстие 7, а затем подключите его к плате ESP32.**

| Компонент | Провод | Вывод платы ESP32 |
| :-------: | :-------: | :-------------: |
| СВЕТОДИОД | 3PIN 20 см | io27 |

**Подключите красный к V, черный к G, желтый к io27.**

| Вывод модуля | Цвет провода |
| :--------: | :--------: |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |
| S | ЖЕЛТЫЙ |

![img](./scratch_img/image083.png)

------

#### 11.13 Датчик уровня воды

**Пропустите провод датчика уровня воды через отверстие 13, а затем подсоедините его к плате ESP32.**

| Компонент | Провод | Вывод платы ESP32 |
| :----------------: | :-------: | :-------------: |
| Датчик уровня воды | 3-контактный разъем 25 см | io33 |

**Подключите красный к разъему V, черный к разъему G, желтый к разъему io33.**

| Вывод модуля | Цвет провода |
| :--------: | :--------: |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |
| S | ЖЕЛТЫЙ |

![img](./scratch_img/image084.png)

------

#### 11.14 Датчик влажности почвы

**Пропустите провод датчика влажности почвы через отверстие 11, а затем подключите его к плате ESP32.**

| Компонент | Провод | Вывод платы ESP32 |
| :------------------: | :-------: | :-------------: |
| Датчик влажности почвы | 3-контактный, 20 см | io32 |

**Подключите красный к V, черный к G, желтый к io32.**

| Контакт модуля / Цвет провода |
| :--------: | :--------: |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |
| S | ЖЕЛТЫЙ |

![img](./scratch_img/image085.png)

------

#### 11.15 Модуль реле  

| Компонент | Провод | Вывод на плате ESP32 |
| :----------: | :--: | :-------------: |
| Релейный модуль | 3PIN | io25 |

**Пропустите провод водяного насоса через отверстие 11, как показано ниже:**

![img](./scratch_img/image086.png)

**Подключите красный к V, черный к G, желтый к io25.**

| Вывод модуля | Цвет провода |
| :--------: | :--------: |
| V | КРАСНЫЙ |
| G | ЧЕРНЫЙ |
| S | ЖЕЛТЫЙ |

![img](./scratch_img/image087.png)

------

#### 11.16

![img](./scratch_img/image088.png)

------



### Шаг 12

------

#### 12.1 Необходимые компоненты

![img](./scratch_img/image089.png)

------

#### 12.2

![img](./scratch_img/image090.png)

------

#### 12.3

![img](./scratch_img/image091.png)

------

#### 12.4

![img](./scratch_img/image092.png)

------

#### 12.5

![img](./scratch_img/image093.png)

------



### Шаг 13

------

#### 13.1 Необходимые компоненты

![img](./scratch_img/image094.png)

------

#### 13.2

![img](./scratch_img/image095.png)

------

#### 13.3

![img](./scratch_img/image096.png)

------



### Шаг 14

------

#### 14.1 Необходимые компоненты

![img](./scratch_img/image098.png)

------

#### 14.2

![img](./scratch_img/image099.png)

------

#### 14.3

![img](./scratch_img/image100.png)

------

#### 14.4

![image-20230718085623979](./scratch_img/image-20230718085623979.png)

------

#### 14.5

![image-20230718085641291](./scratch_img/image-20230718085641291.png)

------

#### 14.6

![image-20230718085722378](./scratch_img/image-20230718085722378.png)

------

#### 14.7

![image-20230718085743776](./scratch_img/image-20230718085743776.png)

------



### Шаг 15

------

#### 15.1 Необходимые компоненты

![image-20230718085854136](./scratch_img/image-20230718085854136.png)

------

#### 15.2

![image-20230718085921988](./scratch_img/image-20230718085921988.png)

------

#### 15.3

![image-20230718085936256](./scratch_img/image-20230718085936256.png)

------

#### 15.4

![image-20230718085954487](./scratch_img/image-20230718085954487.png)

------



### Шаг 16

------

#### 16.1 Необходимые компоненты

![image-20230718090031524](./scratch_img/image-20230718090031524.png)

------

#### 16.2

![image-20230718090057124](./scratch_img/image-20230718090057124.png)

------

#### 16.3

![image-20230718090110113](./scratch_img/image-20230718090110113.png)

------

#### 16.4

![image-20230718090127577](./scratch_img/image-20230718090127577.png)

------



### Шаг 17

------

#### 17.1 Необходимые компоненты

![image-20230718090150918](./scratch_img/image-20230718090150918.png)

------

#### 17.2

![image-20230718090215504](./scratch_img/image-20230718090215504.png)

------

#### 17.3

![image-20230718090227072](./scratch_img/image-20230718090227072.png)

------



### Шаг 18

------

#### 18.1

![img](./scratch_img/image128.png)

------

#### 18.2

![img](./scratch_img/image129.png)

------



#### 18.3

![img](./scratch_img/image130.png)

------

#### 18.4

![img](./scratch_img/image131.png)

------

#### 18.5

![img](./scratch_img/image132.png)

------

#### 18.6

![img](./scratch_img/image131-1.png)

------

#### 18.7

![img](./scratch_img/image132-1.png)

------

#### 18.8

![img](./scratch_img/image133.png)

------

#### 18.9

![img](./scratch_img/image135.png)

------

#### 18.10

![image-20230718091556561](./scratch_img/image-20230718091556561.png)

------



### Шаг 19

------

#### 19.1

![image-20230718091623881](./scratch_img/image-20230718091623881.png)

------

#### 19.2

![image-20230718091649546](./scratch_img/image-20230718091649546.png)

------

#### 19.3

![image-20230718091701966](./scratch_img/image-20230718091701966.png)

------

------

## Проекты

### Проект 1: Система освещения

** Давайте начнем наш первый проект "система освещения".**

------

Включение светодиода - одна из самых фундаментальных практик Arduino. 

Этот вводный урок предназначен для начинающих пользователей, которые хотят разобраться в программировании аппаратного и программного обеспечения на плате разработки ESP32 и овладеть базовыми схемами и знаниями в области программирования.

![img](./scratch_img/cout 1.png)

Таким образом, наше руководство по обучению очень простое. И этот интригующий проект может быть применен в реальных условиях дома или в офисе.

В этом проекте вы познакомитесь с основными подключениями и настройками платы разработки ESP32 при программировании на Arduino. Более того, вам также будут представлены некоторые функции, такие как включение / выключение светодиода с помощью выходного уровня цифрового вывода или кнопки. 

В целом, это учебное пособие начального уровня, которое заложит основу для последующих практик в Arduino.



------



#### Блок-схема

![image-20230607175228556](./scratch_img/image-20230607175228556.png)



------



#### Включите светодиод

##### Описание

СВЕТОДИОД, сокращенно от светоизлучающий диод, представляет собой твердотельный полупроводник, который преобразует электрическую энергию в видимый свет, поэтому его также называют твердотельным источником света. 

Когда ток проходит через светодиод, он загорается.

** Различные светодиодные:**

![img](./scratch_img/cou1.png)



------



**Светодиодный модуль** - это устройство для вывода, яркостью и миганием которого можно управлять. Для использования вам нужно всего лишь подключить его непосредственно к цифровым выходным контактам на плате разработчика.

![img](./scratch_img/cou12.png)

------



**Принцип работы:**

Когда значение S достигает высокого уровня, триод Q1 переходит в режим проводимости, и напряжение переменного тока проходит через светодиод, чтобы он загорелся. 

![img](./scratch_img/couy1.png)



**Параметры:**

- Напряжение: 3~5 В
- Ток: ≤1,5мА
- Мощность: 0,07 Вт



------



##### Схема подключения

**Подключите светодиодный модуль к io27.**

**Внимание: желтый цвет подключите к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj1.png)



------



##### Тестовый код

- Откройте Kidsblock и выберите правильное устройство и порт. 

  ![img](./scratch_img/st1.png)

- Перетащите ![img](./scratch_img/st11.png) из ![img](./scratch_img/st14.png) в область редактирования кода. Блоки кода выполняются только тогда, когда они находятся в этой области.

  ![img](./scratch_img/st12.png)

- С этим блоком при загрузке платы разработки будет выполняться код. 

  ![img](./scratch_img/st11.png)

- В ![img](./scratch_img/st15.png) перетащите “**навсегда**” и вставьте его под предыдущий блок. Блок “**навсегда**” указывает на цикл.

  ![img](./scratch_img/st20.png)

- Перетащите блок "**Вывод светодиодного вывода**" из ![img](./scratch_img/st16.png) и вставьте его в “**навсегда**”. Установите вывод на IO27, а выходной уровень - на ВЫСОКИЙ, чтобы вывод светодиода продолжал выдавать высокий уровень. 


![img](./scratch_img/st21.png)

![img](./scratch_img/st22-1.png)

- Добавить задержку в 1 секунду. Продублируйте блок "**Вывод светодиодного вывода**", но установите выходное значение на НИЗКОЕ, а также добавьте задержку. Затем светодиод загорится и погаснет при обращении. 

  ![img](./scratch_img/st22.png)

##### Результат теста

Светодиод мигает каждую секунду, потому что io27 на плате ESP32 выдает высокий и низкий уровни поочередно каждую секунду. Кроме того, с помощью светодиода можно реализовать различные интерактивные приложения, такие как индикатор дыхания, индикаторы потока воды и мигающий полицейский фонарь.

| Уровень мощности | Результат |
| :---------: | :-----: |
| ВЫСОКИЙ | светодиод включен |
| НИЗКИЙ | светодиод выключен |



------



##### Расширение: Дышащий светодиод

###### Описание

Интерфейсы ввода-вывода MCU (arduino UNO, ESP32 и Raspberry Pi Pico) выводят только цифровые сигналы (высокого или низкого уровня). Например, в предыдущем эксперименте (включение светодиода) цифровые выходы были только высокими (3,3 В) и низкими (0 В).

Если микроконтроллер выдает высокий уровень 3,3 В или низкий уровень 0 В, входное напряжение должно быть на уровне 0~3,3 В. Таким образом, ШИМ (широтно-импульсная модуляция) необходима для вывода другого значения напряжения, которое называется "аналоговый выход".

![img](./scratch_img/cou1k1.png)

------



###### Знания

Что такое ШИМ?

ШИМ содержит три элемента: частоту (Гц), период, рабочий цикл (%).

- ** Частота ШИМ (f):** время изменения сигнала с высокого на низкий и возврата к высокому в течение одной секунды. Вообще говоря, частота - это количество периодов ШИМ в секунду.

- **Период ШИМ (T):** Период = 1 / Частота (T=1/f, а 1 означает 1 секунду). Например: f = 50 Гц, следовательно, T = 20 мс, что означает, что периодичность составляет 50 раз в секунду.
- ** Рабочий цикл ШИМ:** отношение времени высокого уровня ко всему периоду. Если период = 10 мс и 8 мс - это длительность импульса, то низкий уровень занимает 2 мс, поэтому рабочий цикл = 8/(8+2) = 80%.

![img](./scratch_img/cou1k2.png)

**Вывод: При соответствующей частоте сигнала ШИМ изменяет эффективное выходное напряжение, изменяя рабочий цикл за один период.** Проще говоря, в течение указанного времени, чем выше уровень выходного сигнала порта ввода-вывода, тем больше значение ШИМ и тем светлее будет светодиод. 

![img](./scratch_img/cou1k3.png)

###### Тестовый код

![img](./scratch_img/st23.png)

- Определите переменную **item** и присвойте ей значение 0.

  ![img](./scratch_img/st25.png)

- Перетащите блок "**навсегда**" и вставьте в него блок "**повторять**". Установите время повторения равным 255.

  ![img](./scratch_img/st26.png)

- Перетащите блок "**режим переменной **" в "**повтор**" и установите режим на “**++**”, что означает, что **элемент** будет увеличиваться на 1 после каждого выполнения.

  ![img](./scratch_img/st27.png)

- Найдите блок для настройки PWM, который содержится в ![img](./scratch_img/st16.png), как показано ниже, поэтому вам нужно только установить соответствующий вывод и аналоговое значение для вывода ШИМ.

  ![img](./scratch_img/st28.png)

  - Установить вывод светодиода:

    ![img](./scratch_img/st29.png)

  - Установить канал: (всего 16 каналов, включая 0~15)

    ![img](./scratch_img/st30.png)

  - Установите выходное значение ШИМ на **пункт **, что автоматически добавит 1 к значению от 0 до 255. ** Выходное значение ШИМ равно 0~255, поэтому мы устанавливаем время повторения равным 255.**

    ![img](./scratch_img/st31.png)

- Увеличьте задержку до 0,01 секунды, чтобы светодиод загорался постепенно, а не внезапно. 

  ![img](./scratch_img/st32.png)

- Продублируйте блок "**repeat**" следующим образом, но установите режим "**--**", который каждый раз уменьшает значение переменной **item**. И светодиод будет постепенно тускнеть. 

  ![img](./scratch_img/st33.png)



###### Результат теста

Светодиод загорается и постепенно гаснет; он равномерно "дышит". 

![img](./scratch_img/st34.gif)


#### Кнопка

##### Описание

**Кнопочный модуль** - это устройство для ввода данных. Микроконтроллер считывает уровень его мощности, чтобы определить, нажата ли кнопка. 

![img](./scratch_img/cou13.png)

------



**Принципиальная схема:**

![img](./scratch_img/couy12.png)

**Параметры:**

- Напряжение: 3 ~5 В
- Ток: ≤1,1 мА
- Мощность: ≤5,5МВт



------



**Принцип работы кнопочного модуля основан на схеме, управляемой этой кнопкой.**

- **При нажатии кнопки** цепь находится в замкнутом состоянии, так что ток проходит через кнопку к GND, что приводит к обнаружению низкого уровня на выводе цифрового входа.
- **При отпускании кнопки** цепь отключается, и уровень напряжения на выводе повышается благодаря повышающему резистору, который позволяет цифровому выводу обнаруживать высокий уровень.



------



##### Схема подключения

**Подключите кнопочный модуль к io5**

**Внимание: Подключите желтый цвет к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj12.png)



------



##### Тестовый код

- Прежде всего, инициализируйте последовательный порт и установите скорость передачи данных в бодах на 115200.

  ![img](./scratch_img/st36.png)

- Установите pin-код на IO5 и режим ввода. То, что следует за этим, - это блок "**навсегда**".

  ![img](./scratch_img/st37.png)

- Считайте уровень мощности цифрового вывода 5. Если он равен 1, выведите 1. В противном случае выведите 0.

  ![img](./scratch_img/st38.png)


Полный код: 

![img](./scratch_img/st35.png)



##### Результат теста

Откройте serial monitor и установите соответствующую скорость передачи данных в бодах. 

Когда кнопка отпущена, значение равно 1; если вы нажмете кнопку, оно станет равным 0.

![img](./scratch_img/st39.png)

В Scratch мы можем считывать состояние цифрового входного контакта, программируя, чтобы определить, нажата ли кнопка. Таким образом, с помощью кнопочного модуля можно реализовать множество интерактивных приложений, таких как включение / выключение светодиода и регулировка яркости дисплея. 



------



##### Расширение: Кнопка автоматической блокировки

Кнопка автоматической блокировки не выскакивает, когда вы нажимаете ее, не удерживая нажатой, и никогда не выскакивает, если вы не нажмете ее снова. Она работает как переключатель. Для обычных кнопок такая функция может быть реализована с помощью микроконтроллера и программного обеспечения. 

###### Тестовый код

- Определите две переменные: **item** как значение кнопки чтения и **button** как значение, изменяемое кнопкой. 

  ![img](./scratch_img/st40.png)

- Присвоить кнопке чтения значение **item**.

  ![img](./scratch_img/st41.png)

- Определить, нажата ли кнопка. Если нажата, измените значение **button** и распечатайте его.

  ![img](./scratch_img/st43.png)

  - Задержка 0,01 с для устранения дрожания кнопки. 
    - Если кнопка находится в закрытом состоянии, будет выполнена задержка для устранения дрожания переднего крыльца. Как правило, задержка составляет от 5 до 10 мс (это зависит от механических свойств). После исчезновения дрожания проверьте состояние кнопки еще раз. Если уровень закрытого состояния все еще сохраняется, это подтверждает нажатие кнопки.
    - При обнаружении нажатой кнопки также должна произойти задержка в 5-10 мс, чтобы устранить дрожание заднего крыльца, чтобы можно было выполнить программу для кнопки.

- Когда кнопка нажата, значение **button** равно 1. Нажмите ее еще раз, значение **button** изменится на 0, в качестве альтернативы. 



Полный код: 

![img](./scratch_img/st44.png)



###### Результат теста

Загрузите код и откройте последовательный монитор. 

При однократном нажатии кнопки на дисплее отобразится значение 1. При повторном нажатии кнопки значение становится равным 0. Теперь обычная кнопка может похвастаться функцией автоматической блокировки. 

![img](./scratch_img/st46.png)



------



#### Управление освещением

##### Описание

В приведенных выше базовых экспериментах мы переделали кнопку автоматической блокировки для управления светодиодом. Кнопка автоматической блокировки подходит для любых ситуаций, когда необходимо поддерживать определенное состояние, например, когда светодиод должен гореть в течение длительного времени, для некоторых операций требуется плата разработки ESP32.

В этом эксперименте мы используем плату Arduino ESP32, которая поможет вам создать систему освещения и смоделировать реальные сцены для управления светом с помощью кнопки.



------



##### Схема подключения

**Подключите кнопку к io5, а светодиод - к io27.**

**Внимание: Подключите желтый цвет к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj13.png)



------



##### Тестовый код

Последовательность выполнения кода: 

![img](./scratch_img/flo1.png)



Полный код: 

На основе кода для кнопки автоматической блокировки мы добавляем блоки "**Вывод светодиодного вывода**".

![img](./scratch_img/st47.png)



##### Результат теста

**При однократном нажатии кнопки загорается светодиод; при повторном нажатии светодиод гаснет. Эта операция представляет собой цикл, который в действительности соответствует принципу освещения.**



------



В этой главе мы продемонстрировали, как программировать и управлять с помощью Scratch, и в ходе экспериментов изучили основы, а также некоторые программные и аппаратные концепции, такие как кнопка автоматической блокировки и система управления освещением.

Это важно для хорошего разработчика Scratch. Далее мы поможем вам изучить больше приложений и навыков, независимо от того, новичок вы или опытный пользователь. Надеемся, что вам понравятся занятия и трудности во время изучения Scratch. Давайте двигаться дальше!



------



#### Часто задаваемые вопросы

##### Вопрос: после загрузки кода индикатор не загорается.

О: Пожалуйста, проверьте, соответствует ли pin-код, указанный в коде, pin-коду, указанному в вашей проводке. Если они несовместимы, пожалуйста, измените его в соответствии с кодом. 

------

##### В: Кнопка иногда работает, а иногда нет.

О: Пожалуйста, измените задержку устранения дрожания на правильное значение. 

``c++
 //Устраните дрожание кнопок
   задержка(10); //Измените значение задержки в этой строке
```

------

### Проект 2: Система управления освещением

В этом проекте мы создадим систему управления освещением с помощью фоторезистора и светодиода. Это интеллектуальная система регулировки освещения, которая экономит энергию и повышает эффективность. 

![img](./scratch_img/cout2.png)

Эта система совместима с различными условиями. Благодаря своему фоторезистору она способна определять интенсивность освещения днем или ночью, что обеспечивает более интеллектуальную и энергосберегающую систему. 

Когда фоторезистор обнаруживает, что яркость окружающей среды ниже установленного значения, загорается светодиод. Напротив, если интенсивность окружающего освещения превышает установленное значение, фоторезистор подает другой сигнал для выключения светодиода.



------



#### Технологическая схема

![image-20230607175802112](./scratch_img/image-20230607175802112.png)



------



#### Фоторезистор

##### Описание

Фоторезистор, также называемый фотосенсором, преобразует световой сигнал в электрический (напряжение, ток и сопротивление). 

** Принцип работы:**

Мы включаем фоторезистор в цепь последовательного подключения и подаем соответствующее напряжение на оба полюса. Когда света нет, сопротивление бесконечно, и цепь практически размыкается. Однако при наличии света сопротивление уменьшается, а ток увеличивается, и при достаточной интенсивности света это эквивалентно короткому замыканию.

Теперь мы определим значение фоторезистора, запрограммировав его на плате разработки ESP32.

![img](./scratch_img/cou2.png)

------



**Принципиальная схема:**

Когда свет попадает на фоторезистор, чем сильнее он излучается, тем меньше будет сопротивление, следовательно, тем большее напряжение переменного тока будет проходить через резистор.

![img](./scratch_img/couy21.png)



**Параметры:**

- Напряжение: 3 ~ 5 В

- Ток: 0,2 мА
- Мощность: 1 МВт
- Пиковое значение спектра: 540 нм
- Сопротивление освещению (10 люксов): 5~10 КР
- Сопротивление затемнению: 0,5 МР



------



##### Схема подключения

**Подключите фоторезистор к io34.**

**Внимание: желтый цвет подключите к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj21.png)



------



##### Тестовый код

- Инициализируем последовательный порт.

  ![img](./scratch_img/st48.png)

- Определяем глобальную переменную "**item**" в качестве значения фоторезистора.

  ![img](./scratch_img/st49.png)

- Установите для "**item**" значение для считывания и выведите его на последовательный монитор.

  ![img](./scratch_img/st50.png)


Полный код:

![img](./scratch_img/st51.png)



------



##### Результат тестирования

Откройте последовательный монитор.

Чем ярче свет, регистрируемый фоторезистором, тем больше будет значение. 

![img](./scratch_img/st52.png)

------



#### Система управления освещением

##### Схема подключения

**Подключите фоторезистор к io34, а светодиод к io27.**

**Внимание: желтый цвет подключите к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj22.png)



------



##### Тестовый код

Последовательность выполнения кода:

![img](./scratch_img/flo2.png)



- Определить:

  - Значение фоторезистора >= 800, светодиод гаснет.
  - Значение фоторезистора =< 800, светодиод включается.

  ![img](./scratch_img/st53.png)


Полный код:

![img](./scratch_img/st54.png)

##### Результат теста

Когда значение фоторезистора превышает 800 (в дневное время), светодиод гаснет. Однако, если значение меньше 800, светодиод автоматически загорается. 

![img](./scratch_img/st55.png)

------



**Этот тип системы может применяться в различных условиях. Благодаря фоторезистору он способен определять интенсивность освещения днем или ночью, что позволяет экономить энергию и интеллектуализировать всю систему. **



------



#### Часто задаваемые вопросы

##### Вопрос: Значение фоторезистора не может быть равным 0.

О: В реальной жизни, несмотря на то, что вы выключаете весь свет в своей комнате, света мало, поэтому значение фоторезистора приближается к 0, а не равно ему. 

------

##### Вопрос: После загрузки кода светодиод не загорается, даже если в комнате темно без освещения.

О: Увеличьте установленное значение фоторезистора. В нашем примере мы установили значение 800. Таким образом, вы можете настроить его на 1000 или большее значение.

![img](./scratch_img/st53.png)

------


### Проект 3: Система сигнализации



В этом проекте мы используем датчик движения PIR и звуковой сигнал для создания системы сигнализации, которой можно управлять с помощью платы разработки ESP32. 

Как это работает? Электрические сигналы обнаруживаются и считываются датчиком движения PIR с помощью программирования в Arduino IDE, а затем он определяет, есть ли там человек. Если есть, то подается звуковой сигнал. Таким образом, стоимость этой системы сигнализации для семей и офисов намного ниже. 



---



#### Блок-схема

![image-20230606102303743](./scratch_img/image-20230606102303743.png)

------



#### Датчик движения PIR

##### Описание

Датчик движения PIR определяет присутствие человека, ощущая тепло, выделяемое человеческим телом. 

Кроме того, этот датчик имеет небольшие размеры и прост в использовании.

![img](./scratch_img/cou32.png)

------



**Принципиальная схема:**

![img](./scratch_img/couy31.png)



**Параметры:**

- Напряжение: 3 ~ 5 В
- Ток: 3,6 мА
- Мощность: 18 МВт
- Угол обзора: Y = 90°, X = 110° (теоретическое значение)
- Расстояние обнаружения: ≤5 м



------



##### Схема подключения

**Подключите датчик движения PIR к io23.**

**Внимание: Подключите желтый цвет к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj31.png)



------



##### Тестовый код

Считайте значение на выводе IO23, чтобы определить, есть ли движение человека.

![img](./scratch_img/st56.png)



##### Результат теста

Откройте последовательный модуль.

Когда кто-то находится поблизости, на мониторе отображается сообщение "Кто-то", и красный светодиод на датчике гаснет. Однако, если никого нет, ** Никто ** не будет напечатан, и светодиод будет гореть всегда.

**ВНИМАНИЕ**: Датчик движения PIR не способен проникать сквозь предметы, поэтому, пожалуйста, не закрывайте датчик при обнаружении движения.

![img](./scratch_img/st57.png)



------



#### Звуковой сигнал

##### Описание

Зуммер - это электронный эхолот, который издает звуки различной частоты и длительности и питается от постоянного напряжения. Таким образом, его можно использовать в качестве напоминания или сигнала тревоги во многих электронных устройствах, таких как компьютеры, принтеры, копировальные аппараты, сигнализаторы, электронные игрушки, автомобильная электроника, телефоны и таймеры.

![img](./scratch_img/cou34.png)

------



Зуммер состоит из ** вибрационного устройства ** и ** резонансного устройства **. Существует две категории зуммеров: пассивные и активные. 

- Пассивный зуммер не может "вибрировать", издавая звук сам по себе, если не подать сигнал прямоугольной формы с определенной частотой. Кроме того, звук, издаваемый им, меняется из-за разной частоты прямоугольной формы, поэтому пассивный зуммер может имитировать мелодии.
  - Аналоговый сигнал squire можно генерировать, изменяя уровень мощности на выводах. Например, после того, как высокий уровень сохраняется в течение 500 мс, он переходит на низкий уровень еще на 500 мс, а затем снова на высокий уровень...
  - ** Мы запускаем зуммер с помощью частотной волны в диапазоне 200 ~ 5000 Гц, и мы можем вычислить частоту (f): *f=1/T*; T - это период (общее время высокого и низкого уровня). **

![img](./scratch_img/cou35.png)

- Активный звуковой сигнал способен издавать звук автоматически, без внешнего побудителя, поскольку он включает в себя схему возбуждения, для которой требуется только "Источник постоянного тока`.  Однако его звук ровный, с относительно постоянной частотой.



------

**В этом эксперименте для "воспроизведения музыки" использовался пассивный звуковой сигнал.**

------



**Принципиальная схема:**

![img](./scratch_img/cou38.png)

**Параметры:**

- Напряжение: 3 ~ 5 В
- Ток: ≤5 мА
- Мощность: ≤25 МВт



------



##### Схема подключения

**Подключите зуммер к io16.**

**Внимание: Подключите желтый цвет к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj32.png)



------



##### Тестовый код

###### Способ 1: Аналоговая сигнальная волна

Пассивный звуковой сигнал генерируется сигнальными волнами, поэтому мы стимулируем волну.

Аналоговую сигнальную волну можно создать, изменив уровень мощности на выводе: высокий уровень на 500 мкс и низкий уровень на 500 мкс. При этом будет издаваться звуковой сигнал. Кроме того, с помощью длительности можно регулировать громкость звука. 

Пожалуйста, попробуйте 1000, 1500, 3000... В чем разница?

![img](./scratch_img/cou36.png)

Код:

![img](./scratch_img/st58.png)

- В функции delay единица измерения времени - микросекунды. Таким образом, следующий блок представляет задержку в 500 мс.

![img](./scratch_img/st59.png)

В соответствии с формулой:
$$
f=1/T
$$
Таким образом, длительность составляет 500 мкс, и мы можем рассчитать частоту, равную 2 кГц, т.е. высокий и низкий уровень меняются 2000 раз в секунду.



------



###### Способ 2: Блоки динамиков

Мы используем динамик![img](./scratch_img/st60.png) кодовые блоки, вызывающие вибрацию зуммера.

**Блоки динамиков генерируют ШИМ-сигнал определенной частоты, который заставляет зуммер вибрировать,** а длительность и тональный сигнал регулируются соответствующими параметрами.

Существует два способа определения длительности. Один из них заключается в настройке параметров функции tone() для установки длительности, а другой - в использовании функции noTone() для прямой остановки звука. Если вы не зададите длительность в tone(), звуковой сигнал будет генерироваться всегда, пока функция noTone() не остановит его.

На плате ESP32 одновременно может воспроизводиться только один звуковой сигнал. Если один вывод ESP32 генерирует звуковой сигнал с помощью тонального сигнала(), запрещается воспроизводить звук с помощью этой функции на другом выводе.



**Таблица звуковых сигналов**

![img](./scratch_img/cou37.png)



Код:

- Перетащите блок "**Тон**" из ![img](./scratch_img/st60.png), как показано ниже, и установите pin-код на IO16.

  ![img](./scratch_img/st61.png).

- Вы можете выбрать частоту по своему усмотрению.

  ![img](./scratch_img/st62.png)

- Нет звукового сигнала: используется для отключения всех звуковых сигналов. 

  ![img](./scratch_img/st65.png)


Полный код:

![img](./scratch_img/st63.png)

##### Результат проверки

Метод 1: Звуковой сигнал продолжает звучать. 

Метод 2: Звуковой сигнал подается с помощью функции тонального сигнала().



------



##### Расширение: Воспроизведение музыки

Воспроизведение музыки с помощью тонального сигнала(). 

Полный код:

![img](./scratch_img/st64.png)



---



#### Система сигнализации

В этом эксперименте мы создадим систему сигнализации с помощью датчика движения PIR, звукового сигнала и светодиода. Когда датчик обнаруживает движение, раздается звуковой сигнал, а светодиод мигает, напоминая о вторжении.



------



##### Схема подключения

**Подключите датчик движения PIR к io23, звуковой сигнал - к io16, а светодиод - к io27.**

**Внимание: Подключите желтый цвет к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj33.png)



------



##### Тестовый код

Последовательность выполнения кода:

![img](./scratch_img/flo3.png)



Полный код:

![img](./scratch_img/st66.png)



##### Результат проверки

Введите код, и система сигнализации начнет работать. При обнаружении движения включается звуковой сигнал и мигает светодиод. 



------



#### Часто задаваемые вопросы

##### Вопрос: Звуковые сигналы не совпадают с фактическими.

О: Этот обычный звуковой сигнал просто генерирует звуковые сигналы, поэтому он не соответствует профессиональным требованиям. Если вам нужны стандартные звуковые сигналы, требуется более специализированный динамик. 

------

##### Вопрос: Датчик движения PIR неправильно отображает результаты.

О: Этот датчик движения PIR также не является профессиональным. 

Пожалуйста, обратите внимание на следующие ситуации, чтобы избежать неверной информации: 

- Не допускайте, чтобы в зоне обнаружения трепетали предметы, переносимые ветром, такие как занавески, одежда и цветы.
- Избегайте попадания в зону обнаружения яркого света, такого как солнечный свет, автомобильные фары, прожекторы и другие источники света.
- И так далее...

------

### Проект 4: Система обнаружения дождя

***ПРИМЕЧАНИЕ: Попадание воды на датчики (за исключением датчика пара) может привести к короткому замыканию или выходу из строя модулей. Если батареи намокнут, может произойти даже взрыв. Будьте особенно осторожны! Для маленьких пользователей, пожалуйста, работайте с родителями. Чтобы гарантировать безопасность, пожалуйста, соблюдайте инструкции и правила техники безопасности.***

------

В этом проекте мы создадим систему обнаружения дождя с помощью датчика пара. При обнаружении дождя ESP32 запускает различные действия, такие как отправка сообщения, активация разбрызгивателей и включение освещения. С помощью этой системы можно отслеживать количество осадков, а также обнаруживать утечки воды на крышах или в зданиях. 

Кроме того, датчик пара легко подключить к плате ESP32, которая образует простую, но эффективную систему обнаружения дождя.

![img](./scratch_img/cout4.png)



------



#### Блок-схема

![image-20230607180917475](./scratch_img/image-20230607180917475.png)



------



#### Датчик пара

##### Описание

Датчик пара определяет наличие воды, поэтому его обычно используют для обнаружения дождя. Если капли дождя попадут на токопроводящую прокладку датчика, он отправит сигнал на плату Arduino.

![img](./scratch_img/cou41.png)

------



**Принципиальная схема:**

![img](./scratch_img/cou41.png)



**Параметры:**

- Напряжение: 3~5 В
- Ток: 1,5 мА
- Мощность: 7,5 МВт



------



##### Схема подключения

**Подключите датчик пара к io35.**

**Внимание: желтый цвет подключите к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj41.png)



------



##### Тестовый код

- Инициализируем последовательный порт.

  ![img](./scratch_img/st67.png)

- Считываем значение датчика на выводе io35 и выводим его в секунду. 

  ![img](./scratch_img/st68.png)


Полный код:

![img](./scratch_img/st69.png)





##### Результат теста

Прикоснитесь к области обнаружения влажным пальцем. Чем больше область, к которой вы прикоснулись, тем больше будет значение. 

Вы можете открыть последовательный монитор, чтобы просмотреть текущее значение (диапазон: 0~4095).

![img](./scratch_img/st70.png).



------

#### Система обнаружения дождя

##### Описание

Когда датчик пара обнаруживает дождь, он посылает сигнал на панель управления для запуска различных действий, например, звукового сигнала, напоминающего о том, что идет дождь. Это особенно полезно для садоводства и фермерства на открытом воздухе, позволяя пользователям принимать необходимые меры предосторожности, чтобы избежать чрезмерного полива.

Кроме того, эта система может использоваться для обнаружения утечки воды, чтобы предотвратить повреждение от проникновения воды. В целом, датчик пара универсален и эффективен в различных областях применения.



---



##### Схема подключения

**Подключите датчик подачи пара к io35, а звуковой сигнал - к io16.**

**Внимание: желтый цвет подключите к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj42.png)



------



##### Тестовый код

Последовательность выполнения кода:

![img](./scratch_img/flo4.png)



Код:

- Инициализируйте последовательный порт и определите переменную **item** в качестве полученного значения датчика.

  ![img](./scratch_img/st71.png)

- Получите значение датчика и распечатайте его на последовательном мониторе.

  ![img](./scratch_img/st72.png)

- Полученное значение, обнаруженное датчиком, находится в пределах 800 ~ 1999:

  ![img](./scratch_img/st73.png)

- Полученное значение, обнаруженное датчиком, находится в пределах 2000 ~ 2999:

  ![img](./scratch_img/st74.png)

- Полученное значение, обнаруженное датчиком, превышает 3000:

  ![img](./scratch_img/st75.png)

- В конце блоков кода добавьте "**Без звукового сигнала**", чтобы отключить звуковой сигнал.

  ![img](./scratch_img/st76.png)


Полный код:

![img](./scratch_img/st77.png)



##### Результат теста

Чем больше обнаруженное значение, тем громче будет звуковой сигнал. 



------



#### Часто задаваемые вопросы

##### Вопрос: Является ли датчик пара водонепроницаемым?

О: На зону обнаружения может попасть вода, но места соединения проводов не являются водонепроницаемыми. Во время эксперимента, пожалуйста, следите за тем, чтобы количество воды не было слишком большим для предотвращения короткого замыкания.

------

##### В: Несмотря на то, что с момента обнаружения воды датчиком прошло много времени, звуковой сигнал продолжает звучать.

О: Он продолжает звучать, потому что в зоне обнаружения все еще есть капли воды. Пожалуйста, просто очистите ее.

------

### Проект 5: Солнечная энергетическая система

![img](./scratch_img/cou51.png)



#### Описание

Солнечная панель преобразует солнечную энергию в электричество для светодиодов. Она подходит для различных применений, таких как наружное освещение, зарядка мобильных устройств и резервное питание. Таким образом, вы можете создать сложную и эффективную солнечную энергетическую систему в соответствии со своими потребностями.



------



#### Принцип работы

**Как солнечная панель преобразует солнечную энергию в электричество?**

![img](./scratch_img/cou52.png)

Солнечная панель поглощает свет и прямо или косвенно преобразует солнечное излучение в электричество. По сравнению с обычной угольной электростанцией, солнечная энергия, энергия ветра и энергия воды являются более энергосберегающими и экологичными.



------



** Как свет преобразуется в электричество?**

Далее, давайте поговорим о процессе преобразования энергии внутри солнечной панели во внешнюю.



** Солнце излучает энергию в виде волн с широким диапазоном длин волн, от ультрафиолетового до видимого и инфракрасного света.**

- Длина волны ультрафиолета: 150 ~ 400 нм;
- Длина волны видимого света: 400~760 нм;
- Длина волны инфракрасного излучения: 760~ 4000 нм;

*** Панель поглощает один из этих диапазонов длин волн и преобразует их в электричество. Но как? Давайте двигаться дальше.***



------



**Активная часть большинства элементов солнечных панелей изготовлена из полупроводника - кремния (Si).**

![img](./scratch_img/cou53.png)

При атмосферной температуре проводимость полупроводника находится между проводником и изолятором. Как правило, он плохо проводит ток, но при определенных условиях его проводимость улучшается.



------



![img](./scratch_img/cou54.png)

**На схеме выше показана внутренняя структура полупроводника в солнечном элементе, который разделен на три слоя:**

1. **Верхний слой (красная часть)** состоит из кремния (Si) и небольшого количества фосфора (P). Последний несет больше электронов, чем первый, обеспечивая достаточное количество электронов для верхнего слоя. Благодаря свободному перемещению электронов этот слой является проводящим, поэтому его называют отрицательным или N-типа.** 
2. ** Средний слой (серая часть) ** содержит слишком мало электронов для проведения тока. 
3. ** Нижний слой (зеленая часть) ** в основном состоит из кремния (Si) и бора (B). Последний несет меньше электронов, чем первый, так что лишь немногие электроны перемещаются свободно, что приводит к отсутствию электронов, которые описываются как эффективный положительный заряд. Поэтому этот слой называется **Положительным или P-типа.** 

![img](./scratch_img/cou55.png)



** Обычно только средний слой солнечной панели поглощает световые волны с длиной волны 350 ~ 1140 нм.** Согласно распределению спектра, приведенному в предыдущих параграфах, поглощаются длинноволновый ультрафиолетовый, коротковолновый инфракрасный и видимый свет.



** Длина волны ультрафиолета настолько мала, что он не попадает на поверхность.**

![img](./scratch_img/cou56.png)



**Длина волны инфракрасного излучения слишком велика для поглощения панелью, поэтому оно обычно проходит сквозь нее или отражается обратно.** 

![img](./scratch_img/cou57.png)



Средний слой поглощает свет и выбивает электроны из кремния в верхнем слое, оставляя их в свободном состоянии, а на том месте, где они были раньше, образуются пустые электронные дырки. 

![img](./scratch_img/cou58.gif)

Дырки несут положительный заряд. Тем временем свободные электроны движутся вверх, достигая слоя N-типа, в то время как дырки движутся вниз, достигая слоя P-типа.



** В заключение, электроны в верхнем и нижнем слоях выбрасываются после того, как средний слой поглощает солнечную энергию. Таким образом, слой N-типа несет отрицательный заряд как отрицательный полюс, в то время как слой P-типа заряжен положительно как положительный полюс. В этом случае, пока два слоя соединены, он проводит ток.** 



------

Если солнечный свет попадает на солнечную панель, описанная выше ситуация сохраняется, и образуется большое количество свободных электронов и дырок. Как следует из нашего вывода, электроны движутся вверх, а дырки - вниз, что образует два полюса и генерирует ток.

![img](./scratch_img/cou59.gif)



------



![img](./scratch_img/cou510.png)



Солнечная энергия - это альтернативный источник энергии, который отличается экологичностью и экономичностью.

Однако электроэнергия, вырабатываемая одной солнечной панелью, может быть преобразована в несколько ватт энергии, которых достаточно для работы калькулятора или зарядного устройства для мобильного телефона, но недостаточно для работы тостера мощностью в один киловатт.

Системы солнечной энергетики удовлетворяют потребности различных пользователей и приносят пользу окружающей среде. В сочетании с программированием на Arduino такая система позволяет создавать множество полезных и эффективных приложений для использования солнечной энергии, таких как автоматическое освещение, зарядные устройства и "умные дома".

В целом, солнечная энергетика обещает прекрасное и устойчивое будущее.



------



#### Параметры

- Напряжение: 5 В
- Ток: 80 мА
- Мощность: 400 МВт
- Размеры: 60 * 60 мм



------



#### Результат теста

В этом проекте коды не требуются. Важно то, что мы узнаем о новой экологической энергии - солнечной энергии. 

При хорошем освещении светодиод загорается желтым цветом. Чем ярче освещение, тем ярче будет гореть светодиод.



------



#### Часто задаваемые вопросы

##### Вопрос: Почему солнечная панель все еще работает без солнечного света?

О: Она работает не только при солнечном, но и при окружающем освещении. Чем ярче свет, тем больше будет напряжение и тем светлее будет светодиод.

------



### Проект 6: Интеллектуальная система кормления



В этом проекте ультразвуковой модуль определяет, находятся ли животные в зоне кормления, и сервопривод автоматически открывает кормушку для домашней птицы. Кроме того, внедрение Интернета вещей позволяет осуществлять дистанционный мониторинг таких систем кормления, что обеспечивает большое удобство. 

В целом, автоматизация и дистанционное управление оптимизируют процесс подачи в этой системе.

![img](./scratch_img/cout6.png)



------



#### Технологическая схема

![image-20230607085516167](./scratch_img/image-20230607085516167.png)



------



#### Сервопривод

#### Описание

** Сервопривод**, также называемый ** Радиоуправляемым сервоприводом**, представляет собой двигатель с обратной связью. Как правило, сервопривод выполняет точное управление положением и выдает высокий крутящий момент, что чаще всего используется в робототехнических проектах, радиоуправляемых автомобилях, самолетах и т.д.

![img](./scratch_img/cou64.png)



----



**Внутренняя структура:**

![img](./scratch_img/cou61.png)

- ① Сигналы: Он получает управляющий сигнал от микроконтроллера. 
- ② Потенциометр: часть обратной связи сервопривода. Он измеряет положение выходного вала.
- ③ Встроенная плата (внутренний контроллер): ядро сервопривода. Она обрабатывает внешний управляющий сигнал и сигнал обратной связи о положении и приводит в действие сервопривод. 
- ④ Двигатель постоянного тока: исполнительная часть. Он выдает скорость, крутящий момент и положение. 
- ⑤ Система передач: она масштабирует мощность двигателя до конечного выходного угла в соответствии с определенным передаточным отношением.



------



**Привод сервопривода:**

Сигналы принимаются ШИМ для управления выходом сервопривода, и ** положение выходного вала напрямую зависит от рабочего цикла ШИМ**. 

Например:

- Если мы отправим сигнал с длительностью импульса 1,5 мс на сервопривод, его вал (звуковой сигнал) повернется в среднее положение (на 90°);
- Если длительность импульса = "0,5мс", вал повернется до минимума (0°);
- Если длительность импульса = "2,5мс", вал поворачивается на максимум (180°).

***ПРИМЕЧАНИЕ: Максимальный угол наклона зависит от типа сервоприводов. У некоторых сервоприводов он равен 170°, а у других - только 90°. Несмотря на это, сервоприводы обычно перемещаются на половину (от максимальной) скорости, если получают сигнал с длительностью импульса 1,5мс.***

![img](./scratch_img/cou62.png)

Период работы сервопривода обычно составляет 20 мс, и он генерирует импульсы с частотой 50 Гц. Большинство сервоприводов обычно работают на частоте 40~200 Гц. 



------



##### Схема подключения

**Подключите сервопривод к io26.**

**Внимание: Подключите желтый цвет к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj61.png)

------



##### Тестовый код

- Инициализируем последовательный порт и определяем переменную **item** с присвоением значения 80.

  ![img](./scratch_img/st78.png)

- Установите ** элемент ** на угол поворота сервопривода от 80° до 180°, поворачивая его на 1° каждые 15 мс.

  ![img](./scratch_img/st79.png)

- Сервопривод поворачивается на 1° каждые 15 мс, от 180° до 80°.

  ![img](./scratch_img/st80.png)


Полный код:

![img](./scratch_img/st81.png)

##### Результат теста

Блок подачи медленно открывается, а затем закрывается, что регулируется.

**ПРИМЕЧАНИЕ: Сервопривод SG90 может поворачиваться на 180°. Поскольку ящик для кормления маленький, достаточно повернуть его на 100°, чтобы он полностью закрылся.**

- 80°: полностью открыт
- 120°: полуоткрыт
- 180°: закрыт

![изображение](./scratch_img/cou63.gif)



------

**ВНИМАНИЕ**

** Не засовывайте пальцы в коробку, чтобы не прищемить их! **

** Не закрывайте дверцу чем-либо, чтобы не повредить сервопривод!**

------



#### Ультразвуковой датчик

##### Описание

![img](./scratch_img/cou65.png)

**Принципиальная схема:**

![img](./scratch_img/couy61.png)



------



Частота звуковых волн, которую может слышать человек, составляет 20 Гц ~ 20 кГц, в то время как ультразвуковые волны находятся за пределами этого диапазона.

**Ультразвуковые волны:** 

![img](./scratch_img/cou66.png)

Ультразвуковой модуль преобразует электрическую энергию и ультразвуковые волны друг в друга за счет пьезоэлектрического эффекта, а также передает и принимает ультразвуковые волны. 

Этот вид волн отличается направленностью, высокой проникающей способностью и легкой концентрацией звуковой энергии.

![img](./scratch_img/cou67.png)

В этой ультразвуковой дальномерной системе мы сначала программируем микроконтроллер (плата разработки ESP32) для генерации оригинальной прямоугольной волны частотой 40 кГц и заставляем ультразвуковой модуль излучать ее. Модуль немедленно вычисляет расстояние до объекта после получения отраженной волны (эхо), усиленной и сформированной схемой. При этом он регистрирует продолжительность излучения и отражения и вычисляет расстояние в соответствии с разницей во времени.

Проще говоря, микроконтроллер управляет модулем, излучая ультразвуковую волну, которая отражается назад после столкновения с препятствиями и принимается модулем. Разница во времени между ними является важным фактором при расчете расстояния (скорость распространения звука в воздухе составляет 340 м/с). 



------



##### Схема подключения

**Подключите эхо-сигнал ультразвукового модуля к io13, а триггер - к io12.**

**Внимание: Подключите желтый к S (сигнал), а красный - к V (питание). Не меняйте их местами!**

![img](./scratch_img/couj62.png)

------



##### Тестовый код

Установите правильный pin-код: Trig - для ввода io12; Echo - для ввода io13.

![img](./scratch_img/st83.png)



##### Результат теста

В этом наборе диапазон обнаружения составляет от 3 до 8 см.

Откройте последовательный монитор и понаблюдайте. 

![img](./scratch_img/st82.png)

------



#### Интеллектуальная система кормления

##### Описание

Интеллектуальная система кормления обеспечивает интеллектуальное кормление домашней птицы с помощью ультразвукового модуля и сервопривода. Первый определяет расстояние до животных, в то время как второй управляет открытием или закрытием кормушки. При обнаружении животного рядом с кормушкой сервопривод открывает ее для кормления.



---



##### Схема подключения

**Подключите эхо-сигнал ультразвукового модуля к io13, а триггер - к io12; подключите сервопривод к io26.**

**Внимание: желтый цвет подключите к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj63.png)



------



##### Тестовый код

Последовательность выполнения кода:

![img](./scratch_img/flo6.png)



Код:

- Инициализируйте последовательный порт. Определите переменную и присвойте ей значение 180. 

  ![img](./scratch_img/st84.png)

- Правильно установите pin-код и выведите полученное значение. 

  ![img](./scratch_img/st85.png)

- Определите значение обнаруженного расстояния. Если оно находится в пределах 2-7 см, откроется ящик для подачи. 

  ![img](./scratch_img/st86.png)


Полный код:

![img](./scratch_img/st87.png)



##### Результат теста

При обнаружении животного откройте коробку с кормом.



-------

**ВНИМАНИЕ**

**Не засовывайте пальцы в коробку, чтобы не быть покусанными! **

**Не закрывайте дверцу чем-либо, чтобы не повредить сервопривод!**

------


#### ЧАСТО задаваемые вопросы





##### В: Сервопривод не работает.

О: Возможно, он застрял сам по себе или в проводах при монтаже нижней панели. перед установкой, пожалуйста, сначала отрегулируйте сервопривод на 180°. Как это сделать, смотрите в руководстве по установке. 

------

##### В: Измеренное расстояние указано неточно.

О: При измерении, пожалуйста, измеряйте расстояние от передающей головки. Данный модуль не является высокоточным детектором, поэтому возможны ошибки.

![img](./scratch_img/cou69.png)

------

### Проект 7: Система контроля температуры



В этом проекте мы продемонстрируем, как использовать датчик температуры и влажности, вентилятор и ЖК-дисплей LCD1602 для создания интеллектуальной системы контроля температуры и влажности.

Система измеряет температуру и влажность окружающей среды и управляет вентилятором для охлаждения по мере необходимости. Когда температура превышает установленный порог, вентилятор автоматически включается, чтобы снизить температуру окружающей среды ниже установленного значения. При этом на ЖК-дисплее 1602 будут отображаться текущие значения температуры и влажности. 

Таким образом, он обеспечивает автоматическую регулировку температуры и влажности окружающей среды, что идеально подходит для проектов, требующих этих функций.

![img](./scratch_img/cout7.png)



------



#### Технологическая схема

![image-20230607121651834](./scratch_img/image-20230607121651834.png)

------



#### Датчик температуры и влажности

##### Описание

Датчик температуры и влажности DHT11 выдает цифровые сигналы. В нем используются принципы сбора и преобразования аналоговых сигналов, а также технология измерения температуры и влажности, что обеспечивает его долговременную стабильность и высокую надежность. Кроме того, датчик объединяет высокоточный резистивный датчик влажности и резистивный термочувствительный датчик температуры и подключен к 8-разрядному высокопроизводительному микроконтроллеру.

![img](./scratch_img/cou71.png)

------



**Средства связи DHT11:**

DHT11 осуществляет связь через monobus (единую шину), которая обеспечивает обмен данными и управление ими.

- Монобус передает ** Бит данных**:

  - Формат данных монобуса: каждый раз передается 40-битная информация, сначала старший бит. 
  - 8-битное целое значение влажности + 8-битное десятичное значение влажности + 8-битное целое значение температуры + 8-битное десятичное значение температуры + 8-битная четность.
  - **ПРИМЕЧАНИЕ: Десятичное значение влажности равно 0.**

- **Четный бит**:
  - 8-битное целое значение влажности + 8-битное десятичное значение влажности + 8-битное целое значение температуры + 8-битное десятичное значение температуры. 
  - 8-битная четность равна конечным 8 битам результата.



**Временная диаграмма:** 

![img](./scratch_img/cou73.png)

**ПРИМЕЧАНИЕ: **

**Хост всегда считывает значения температуры и влажности, полученные при последнем измерении, с DHT11. Поэтому, если интервал между двумя измерениями большой, пожалуйста, выполните два измерения подряд и используйте второй результат.**



Для получения более подробной информации посетите официальный веб-сайт ASAIR: [http://www.aosong.com/products-21.html](http://www.aosong.com/products-21.html)



------



##### Схема подключения

**Подключите датчик температуры и влажности к io17.**

**Внимание: желтый цвет подключите к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj71.png)



------



##### Тестовый код

- Инициализируйте последовательный порт и датчик.

  ![img](./scratch_img/st89.png)

- Последовательный монитор печатает и обновляет значения влажности и температуры в секунду.

  ![img](./scratch_img/st90.png)


Полный код:

![img](./scratch_img/st91.png)



##### Результат теста

![img](./scratch_img/cou71-1.png)

Откройте последовательный монитор, и вы увидите текущее значение температуры и влажности. 

![img](./scratch_img/st88.png)

------



#### ЖК-модуль 1602

##### Описание

LCD 1602 оснащен стандартным 14-контактным интерфейсом (без подсветки) или 16-контактным интерфейсом (с подсветкой), что позволяет экономить контакты микроконтроллера. Его дисплей управляет микросхемой IC для реализации управления I2C. 

![img](./scratch_img/cou72.png)

------



**Последовательная связь I2C:**

Коммуникация I2C, полностью известная как межинтеграционная схема (IIC) или двухпроводной интерфейс (TWI), представляет собой широко используемый протокол связи с двумя шинами (основной и ведомый), разработанный компанией Phillips Semiconductor (приобретенный американской компанией NXP Semiconductors).

Самым большим преимуществом является то, что передача данных осуществляется только по двум проводам, что значительно упрощает схемы. В общей сложности шина I2C может параллельно подключать 127 узлов, поэтому она поддерживает несколько хостов и подчиненных устройств. 

Как правило, для подчиненных устройств внешний источник питания не требуется, так как питание будет передаваться по шине I2C:

![img](./scratch_img/cou75.png)

Шина I2C передает данные с помощью 8-битной передачи данных. Обычно однобайтовые данные состоят из девяти тактовых сигналов, восемь из которых передают данные, а последний означает окончание передачи. 

Кроме того, шина I2C поддерживает многобайтовую передачу данных, непрерывно повторяя описанный выше процесс.



Протокол I2C в основном состоит из:

- **Стартового сигнала**: Перед передачей отправитель передает начальный сигнал, чтобы сообщить получателю о начальной точке.
- **Адрес**: Он уведомляет получателя, кому отправляются данные. 
- **Данные**: Они передаются по одному байту каждый раз и бит за битом. 
- **Сигнал завершения**: При завершении передачи отправитель завершает передачу данных сигналом завершения, информируя получателя о завершении процесса. 



**Временная схема последовательного протокола:**

Для получения более подробной информации, пожалуйста, посетите официальный веб-сайт: [https://www.nxp.com/](https://www.nxp.com/)

![img](./scratch_img/cou76.png)

![img](./scratch_img/cou77.png)

Мы предоставляем вам файл библиотеки **Wire.h** для Arduino для протокола I2C, в котором можно напрямую вызывать функции для взаимодействия с устройствами I2C/TWI. 

Для получения подробной информации о библиотеке, пожалуйста, обратитесь к: 

[https://www.arduino.cc/reference/en/language/functions/communication/wire/](https://www.arduino.cc/reference/en/language/functions/communication/wire/)



------



##### Схема подключения

**Подключите ЖК-дисплей к шине I2C, как показано ниже.**

**Внимание: Подключите желтый цвет к S (сигнал), красный - к V (питание), а черный - к GND. Не меняйте их местами!**

![img](./scratch_img/couj72.png)

------



##### Тестовый код

- Инициализируйте адрес I2C на ЖК-дисплее и включите его подсветку.

  ![img](./scratch_img/st92.png)

- Установите положение курсора на ЖК-дисплее по осям X и Y (по оси X отображается не более 16 символов, а по оси Y - не более 2 столбцов).

  ![img](./scratch_img/st93.png)

- Введите текст для печати (не более 16 символов, иначе он будет неполным). 

  ![img](./scratch_img/st94.png)


Полный код:

![img](./scratch_img/st95.png)



##### Результат теста

ЖК-дисплей 1602 включает заднюю подсветку и отображает ”**HELLO WORLD 0**“ и ”**HELLO WORLD 1**“.

![img](./scratch_img/cou78.png)



-------



#### Fan Module

##### Description

130 Motor is able to adjust speed via PWM. In the process, two pins are needed to be connected for controlling. 

The module is suitable for multiple applications, such as computer heat dissipation and industrial production. What's more it is compact and easy to install, which is very practical.

![img](./scratch_img/cou710.png)

----------



**Schematic Diagram:**

![img](./scratch_img/cou712.png)



-----



##### Wiring Diagram

**Connect the motor to io18 and io19.**

**Attention: Connect yellow to S(Signal), red to V(Power), and black to GND. Do not reverse them!**

![img](./scratch_img/couj73.png)



------



##### Test Code

- Set fan pin **INA**

  ![img](./scratch_img/st96.png)

- Set the power level state of **INA**, which determines the rotation direction of fan.

  ![img](./scratch_img/st97.png)

- Set fan pin **INB**.

  ![img](./scratch_img/st98.png)

- Set the analog output at **INB**, which decides the rotation speed. 

  - When INA is at high, the lower the analog output at INB is, the faster the fan will rotate. 

  - When INA is at low, the greater the analog output at INB is, the faster the fan will rotate. 

    ![img](./scratch_img/st99.png)

  



##### Test Result

130 motor alternatively rotates left and right every 2 seconds.

![img](./scratch_img/cou79.png)

**NOTE: **

**Intermittent stops exist during changing directions of rotation. They prevent an excessive current at the moment of reversal. Otherwise, a forced reset may occur due to insufficient power supply on the development board.**



------



#### Temperature Control System

##### Description

Herein, we read the value of the DHT11 temperature and humidity sensor through monobus communication, and the values will be displayed on the LCD. If values exceed the set threshold, the fan will turn on for dehumidification and cooling to protect the animals and plants in the farm. Remarkably, this system is easy to install with multiple functions, such as speed controlling via PWM and data transmission by monobus. 

Overall, it is a practical system that helps farmers monitor and control the real-time status to improve production efficiency.



---



##### Wiring Diagram

- **Connect the temperature and humidity sensor to io17.**
- **Connect motor(fan) modue to io18 and io19**
- **Connect LCD1602 to BUS I2C.**

**Attention: Connect yellow to S(Signal), red to V(Power), and black to GND. Do not reverse them!**

![img](./scratch_img/couj74.png)



------



##### Test Code

Code Flow: 

![img](./scratch_img/flo7.png)



Code:

- Initialize LCD to set an address, and clear the display. Turn on its backlight and set cursor position: 

  ![img](./scratch_img/st100.png)

- Initialize the DHT11 sensor and choose a corresponding pin. Define two variables as temperature and humidity values. 

  ![img](./scratch_img/st101.png)

- In the loop, respectively assign the detected values to the two variables.

  ![img](./scratch_img/st102.png)

- Display the values on LCD.

  ![img](./scratch_img/st103.png)

- Determine the temperature and humidity value. if temperature is higher than 29° or humidity exceeds 80, fan will rotate. 

  ![img](./scratch_img/st104.png)


Complete code:

![img](./scratch_img/st105.png)



##### Test Result

When the temperature reaches 29°C, the fan will turn on to dissipate heat. When it is lower than 29°C, the fan will turn off (the fan just simulates heat dissipation, so the effect is not good), which saves energy for the farm.



------





#### FAQ

###### Q: Is temperature and humidty sensor waterproof?

A: No. It detects the ambient temperature and humidity (in the air), so please do not put it in water. 

------

###### Q: ESP32 board is reset when fan rotates.

A: When fan rotates, more current is required than other sensors, hence voltage and current may fluctuate in the circuit. Especially at the moment of fan reversal, fluctuations may be too heavy, resulting in a reset due to extremely low voltage and current in ESP32 development board.



------

### Project 8: Soil Humidity Monitoring System

------

***Pay attention! Do not overflow water from plastic pools in experiments. Spilling water on other sensors may cause not only a short circuit or modules to be out of work but also heat generation and even explosion. Do be extra careful! Especially for younger users, please operate with your parents. To guarantee security, please obey guidances and safety regulations.*** 

------

![img](./scratch_img/cout8.png)

------



#### Flow Diagram

![image-20230607161101154](./scratch_img/image-20230607161101154.png)



------



#### Soil Humidity Sensor

##### Description

Soil humidity sensors are mainly used to measure water content in volumetric soil, monitor soil moisture, irrigate crops and protect forests. This kind of sensor is integrated in agricultural irrigation system to supply water regularly and efficiently, which optimize irrigation for a best plant growth.

![img](./scratch_img/cou81.png)

------



**Schematic Diagram:**

![img](./scratch_img/couy81.png)



------



##### Wiring Diagram

**Connect the soil humidity sensor to io32.**

**Attention: Connect yellow to S(Signal), red to V(Power), and black to GND. Do not reverse them!**

![img](./scratch_img/couj81.png)

------



##### Test Code

- Initialize the serial port.

  ![img](./scratch_img/st106.png)

- Print the read sensor value.

  ![img](./scratch_img/st107.png)


Complete code:

![img](./scratch_img/st108.png)



##### Test Result

Open the serial monitor.

Touch the detection area of the sensor with a wet finger and the currently detected humidity value will be printed on the monitor (range: 0~4095).

![img](./scratch_img/st109.png)

------



#### Soil Humidity Monitoring System

We adopt LCD1602 to reveal the real-time value of soil humidity value. When the value is lower than the set minimum humidity, the buzzer will emit sound to prompt farmers of irrigation. 



##### Wiring Diagram

- **Connect the soil humidity sensor to io32.**
- **Connect the buzzer to io16.**
- **Connect the LCD1602 to BUS I2C.**

**Attention: Connect yellow to S(Signal), red to V(Power), and black to GND. Do not reverse them!**

![img](./scratch_img/couj82.png)

------



##### Test Code

Code Flow: 

![img](./scratch_img/flo8.png)



Code: 

- Initialize LCD and clear its display. Turn on the back light to observe the displayed value.

  ![img](./scratch_img/st110.png)

- Initialize the serial port and define a variable. 

  ![img](./scratch_img/st111.png)

- Read the value of the soil humidity value and assign it to the variable. LCD shows the value. 

  ![img](./scratch_img/st112.png)

- Determine the read value. If it is lower than 200, the buzzer will alarm. 

  ![img](./scratch_img/st113.png)


Complete code:

![img](./scratch_img/st114.png)



##### Test Result

When the value detected by the soil humidity sensor is lower than the set threshold, the buzzer emits sound to alarm. 



------



#### FAQ

##### Q: Is soil humidity sensor waterproof?

A: With the exception of the detection area, the sensor is not waterproof. Spilling water on other area may result in a short circuit.



------

### Project 9: Water Level Monitoring System

------

***Pay attention! Do not overflow water from plastic pools in experiments. Spilling water on other sensors may cause not only a short circuit to disturb normal operations but also heat generation and even explosion. Do be extra careful! Especially for younger users, please operate with your parents. To guarantee security, please obey guidances and safety regulations.***

------



#### Flow Diagram

![image-20230607165214387](./scratch_img/image-20230607165214387.png)



------



#### Water Level Sensor

##### Description

The water level sensor is easy to use, portable and cost effective. It integrates a series of exposed parallel lines to measure the volume of water and droplets. Not only is the sensor smaller and smarter than other water detectors, but it also features:


- Smooth transition between water volume and analog volume;
- Strong flexibility. The sensor outputs basic analog values;
- Low power consumption and high sensitivity;
- Directly connect to microprocessors or circuits, and is suitable for various development boards and controllers, such as Arduino controllers, STC and AVR single-chip microcomputers.

![img](./scratch_img/cou91.png)



------



##### Wiring Diagram

**Connect the water level sensor to io33.**

**Attention: Connect yellow to S(Signal), red to V(Power), and black to GND. Do not reverse them!**

![img](./scratch_img/couj91.png)



------



##### Test Code

![img](./scratch_img/st115.png)



##### Test Result

Open the serial monitor.

Touch the detection area of the sensor with a wet finger and the currently detected value will be printed on the monitor (range: 0~4095).

![img](./scratch_img/st116.png)



------



#### Water Level Monitoring System

The water level monitoring system supervises the change of water level to clarify problems in time and take measures to avoid disasters. It is widely used in water conservancy projects, urban drainage and environmental monitoring.



##### Wiring Diagram

- **Connect the water level sensor to io33.**
- **Connect the buzzer to io16.**
- **Connect the LCD1602 to BUS I2C.**

**Attention: Connect yellow to S(Signal), red to V(Power), and black to GND. Do not reverse them!**

![img](./scratch_img/couj92.png)



------



##### Test Code

Code Flow: 

![img](./scratch_img/flo9.png)



Code: 

- Initialize the LCD and turn on its back light; clear all display and then print water level. 

  ![img](./scratch_img/st117.png)

- Define a variable as the detected water level. 

  ![img](./scratch_img/st118.png)

- Read the sensor value and display it on LCD. 

  ![img](./scratch_img/st119.png)

- Determine the water level value. If it is greater than 2000, the buzer will alarm. 

  ![img](./scratch_img/st120.png)


Complete code:

![img](./scratch_img/st121.png)



##### Test Result

LCD displays the real-time value of water level. In the experiment, we cover the detection area with water to stimulate the water level. When the detected value exceeds the threshold, the buzzer starts to alarm.



------



#### FAQ

##### Q: Is water level sensor waterproof?

A: With the exception of the detection area, the sensor is not waterproof. Spilling water on other area may result in a short circuit.

------

### Project 10: Auto-Irrigation System

------

***Pay attention! Do not overflow water from plastic pools in experiments. Spilling water on other sensors may cause not only a short circuit to disturb normal operations but also heat generation and even explosion. Do be extra careful! Especially for younger users, please operate with your parents. To guarantee security, please obey guidances and safety regulations.***

------

In this project, we stimulate irrigation via a water pump controlled by a relay module. Besides, we also determine whether there is water in the pool through water level sensor, and detect the soil humidity by soil humidity sensor. In this way, the system will be more intelligent in controlling the water pump.

![img](./scratch_img/cout10.png)



------



#### Flow Diagram

![image-20230607183214310](./scratch_img/image-20230607183214310.png)



------



#### Water Pumping System

##### Description

In this experiment, we use ESP32 development board to turn on/off the water pump by a relay module. A pump lifts water and transports liquids, and usually is combined with a relay module in usage.

Herein, we connect the relay module and the pump to the ESP32 board, and program to remotely turn on or off the pump through switching the state of relay. For how, we determine the state of relay according to the output value of the module or a preset time.



------



**Relay Module:**

In usage, it is often used in the management of high voltage and load current, say, motors, high-current sensors and high-power lights. 

![img](./scratch_img/cou101.png)

- **Normally Open (NO):** This pin is normally open, unless a signal is received by the signal pin of the relay. Therefore, common pins are disconnected via NC pin and connected through NO pin.

- **Common Contact (COM):** This pin connects to other modules, for example, water pump. 
  - Water Pump: 

![img](./scratch_img/cou1011.png)

- **Normally Closed (NC):** NC pin is linked with COM pin to form a closed circuit. It uses ESP32 board to control the closure and the disconnection of the relay module.



------



**Parameters:**

- Power voltage: 5V
- Static current: 2mA
- Maximum contact voltage: 250VAC/30VDC
- Maximum current: 10A



**Schematic Diagram:**

![img](./scratch_img/couy101.png)



------



##### Wiring Diagram

**Attention: Connect yellow to S(Signal), red to V(Power), and black to GND. Do not reverse them!**

![img](./scratch_img/couj101.png)



------



##### Test Code

![img](./scratch_img/st122.png)



##### Test Result

After uploading code, the device will pump water once. 

In this experiment, the water pump is automatized, reducing time and efforts of manual operation and improving efficiency. Therefore, this water pumping system is wildly used in agricultural production and water treatment. 



------



#### Auto-Irrigation System

##### Description

In this experiment, we implement a smart irrigation system by a soil humidity sensor, a water level sensor, a relay module and a water pump. We connect the two sensors on ESP32 development board and program to read their output values to control the relay and water pump. 

If the soil is very dry, the relay will turn on to control the water pump to irrigate plants; And if the water level is too low, the water pump will not be able to work, and the buzzer will alarm. In this way, plant watering and water level controlling are automatized, which raises production efficiency and reduces the time and efforts of manual operations.



------



##### Wiring Diagram

- **Connect the relay module to io25; connect its NC pin to the GND(black) at io2.**
- **Water pump:**
  - **Connect the red wire to POWER 3V3 of the board**
  - **Connect the black wire(GND) to the COM pin of the relay**
- **Connect the soil humidity sensor to io32**
- **Connect the water level sensor to io33**

**Attention: Connect yellow to S(Signal), red to V(Power), and black to GND. Do not reverse them!**

![img](./scratch_img/couj102.png)



----------



##### Test Code

Code Flow:

![img](./scratch_img/flo10.png)



Code:

- Initialize and clear the LCD, turn on the LCD back light. Define two variables as the detected sensor values. 

  ![img](./scratch_img/st123.png)

- Assign the two read sensor values to those variables. 

  ![img](./scratch_img/st124.png)

- Display these values on LCD.

  ![img](./scratch_img/st125.png)

- If the water level value is lower than 700 or the soil humidity value is less than 1200, the buzzer will alarm. 

  ![img](./scratch_img/st126.png)

- When the soil humidity value is lower than 1200 but the water level value is greater than 700, the water pump will automatically irrigate the farm. 

  ![img](./scratch_img/st127.png)


Complete code:

![img](./scratch_img/st128.png)



##### Test Result

![img](./scratch_img/cou102.png)

- LCD 1602 will display the current values of soil humidity and water level. When the detected humidity is lower than the set threshold, it implies that the soil is being arid, and irrigation starts automatically.
- When the detected water level is lower than the set threshold, the water pumping system doesn't work, and the buzzer alarms to notify that water is insufficient. 
- Press the button to stop alarming.



------

**To sum up, we have achieved an analog auto-irrigation system in this project, which intelligently controls the on and off of the water pump according to the water level. In application, this system usually goes for household and agricultural production.**

------



#### FAQ

##### Q: Are the modules waterproof?

A: The relay module is not, yet the water pump is. The waterproof grade of the water pump is IP68.

------

##### Q: ESP32 board is reset when the water pump works.

A: When water pump works, more current is required than other modules, hence voltage and current may fluctuate in the circuit. Sometimes fluctuations may be too heavy, resulting in a reset due to extremely low voltage and current in ESP32 development board.

When operating the water pump, please follow the example code:

![img](./scratch_img/st127.png)

------

##### Q: Fail to pump water?

A: Several pumping operations are required to fill the water pump before using it. These initial pumpings do not actually draw the water, but to introduce sufficient water into the pump. Only after the pump is full can water be carried out. So we are first for filling, not pumping.	

------

### Project 11: WIFI Control Smart Farm

------

***Pay attention! Do not overflow water from plastic pools in experiments. Spilling water on other sensors may cause a short circuit or modules to be out of work. If batteries get wet, even explosion may occur. Do be extra careful! For younger users, please operate with your parents. To guarantee security, please obey guidances and safety regulations.***

------

![img](./scratch_img/cout11.png)

------



#### Flow Diagram

![image-20230608105334194](./scratch_img/image-20230608105334194.png)

------



#### WIFI Web Page Display

##### Description

ESP32 board is equipped with Wi-Fi(2.4G) and Bluetooth(4.2), which enable it to easily connect to WiFi and communicate with other devices on the network. What's more, web pages can be displayed in browsers via ESP32.

![img](./scratch_img/cou111.png)

**Arduino IDE provides you wih library file <WiFi.h>, which support Wi-Fi configurations and ESP32 Wi-Fi networking monitoring.**

- **Base station mode** (STA or Wi-Fi client-side mode): In this mode, ESP32 connects to the Wi-Fi hotspot (AP).
- **AP mode** (Soft-AP or Wi-Fi hotspot mode): In this mode, other Wi-Fi devices connect to ESP32.
- **AP-STA mode**: In this mode, ESP32 is a Wi-Fi hotspot as well as a Wi-Fi device connecting to another Wi-Fi hotspot.
- These modes is compatible with multiple safe modes, like WPA, WPA2 and WEP.
- It is able to scan for Wi-Fi hotspot, including active and passive scan.
- It supports promiscuous mode to monitor IEEE802.11 Wi-Fi Packets.



------



For wifi details, please refer to: 

[https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/network/esp_wifi.html](https://docs.espressif.com/projects/esp-idf/en/latest/esp32/api-reference/network/esp_wifi.html)

ESPRESSIF official website: [https://www.espressif.com.cn/en/home](https://www.espressif.com.cn/en/home)

![img](./scratch_img/cou112.png)



------



##### Import Library

- Click ![img](./scratch_img/st130.png)

- Click ![st131.](./scratch_img/st131..png)to choose “**Web Page Editing PRO**”, and libraries will be loaded. 

  ![img](./scratch_img/st131.png)



##### Test Code

- Connect to the WiFi hotspot, input your SSID and password.

  ![img](./scratch_img/st134.png)

- Display IP address on LCD

  ![img](./scratch_img/st135.png)

- Define a web page components named temperature (unit: ℃)

  ![img](./scratch_img/st136.png)

  ![img](./scratch_img/st136-1.png)

- Add a button named "button"

  ![img](./scratch_img/st141.png)

  ![img](./scratch_img/st141-1.png)


Complete code: 

![img](./scratch_img/st137.png)



##### Visit the Website

Once connected to WiFi, you can use the ESP32's web server library to serve web pages. In the following example, we will create a simple web page to display a fixed temperature information:

Last but not least, you may open the IP address in browser to visit the web page. In our example code, please input “http://[IP address of ESP32]” to visit the website.

**NOTE: When PC, mobile phones and ESP32 board are connected to one network, you can visit this website at PC and phones at the same time.**

**Here is the ESP32 IP address of your own.**

*PC:*

![img](./scratch_img/st132.png)

*Mobile phone:*

![img](./scratch_img/st133.png)

------



#### WIFI Control Smart Farm

##### Code Flow

![img](./scratch_img/flo11.png)

------

Upload the code.

**SSID** and **PASSWORD** are needed to modify to your wifi name and password:

![img](./scratch_img/st134.png)



##### Complete Code

![img](./scratch_img/st138.png)

------



##### Result

***PC:***

![img](./scratch_img/st140.png)

***Mobile Phone:***

![img](./scratch_img/st139.png)

Input the IP address in browsers at mobile phones or PC, you can check the sensor values and control the LED and fan. 



------



|    Sensor Values    | Controllable Devices |
| :-----------------: | :------------------: |
|   Temperature (℃)   |         LED          |
|   Humidity (%rh)    |         Fan          |
|   Water level (%)   |     Feeding box      |
|    Rainfall (%)     |      Water pump      |
| Brightness (0~4095) |                      |
|  Soil humidity (%)  |                      |



With the ESP32 development board, we have learned how to create a web page to display the sensor values, like temperature, humidity, water level and soil humidity, and we can also control LED lights, fans, feeding boxes and pumps. Moreover, these operations can be remotely finished through mobile phones or computers.

![img](./scratch_img/cou118.png)

In this project, we stimulate a smart farm with intelligent and remote management. Such technology facilitates the control of equipments and improves agricultural efficiency and quality, which make Internet of Things, informatization, automation and intelligence possible.



------



#### FAQ

##### Q: Wifi always fails to be connected. 

A: Move ESP32 to the side of the router and reboot the board, and just be patient to wait. If it still fails to connected, please check whether the WiFi name and password are correct.

------

##### Q: The response is slow during remote opterations on web page.

A: Possible reasons: 

- The router CPU resources are insufficient due to multiple connections. Please reboot the router to try a reconnection.
- The router works for a long time. Please reboot the router.
- Wireless interference. Wireless signal is unstable, so please do not use it through the wall. 



For knowledge of routers, please Google by yourself.

------

##### Q: Fail to pump water?

A: Several pumping operations are required to fill the water pump before using it. These initial pumpings do not actually draw the water, but to introduce sufficient water into the pump. Only after the pump is full can water be carried out. So we are first for filling, not pumping.

------

### Project 12: APP Control Smart Farm

------

***Pay attention! Do not overflow water from plastic pools in experiments. Spilling water on other sensors may cause a short circuit or modules to be out of work. If batteries get wet, even explosion may occur. Do be extra careful! For younger users, please operate with your parents. To guarantee security, please obey guidances and safety regulations.***

------

![img](./scratch_img/cou121.png)

#### Description

The APP management system is able to monitor multiple real-time index of the farm, such as temperature and humidity, pool water level, soil humidity, light intensity and rainfall.

Meanwhile, it also controls LED for lighting, water pump for irrigation, feeding box for feeding and fan for adjusting temperature and humidity.

![img](./scratch_img/cou122.png)



These functions can be realized via an APP on your phone, facilitating farm management. For more intelligence, a buzzer also adopted as an alarm.



------



#### Flow Diagram

![image-20230608150835987](./scratch_img/image-20230608150835987.png)



-------



#### Test Code

##### Code Flow

![img](./scratch_img/flo12.png)



##### Burn Code on ESP32

- Connect ESP32 to WiFi. In the following code, **ssid** and **pwd** are respectively WiFi name and password

![img](./scratch_img/st134.png)

- LCD displays IP address

  ![img](./scratch_img/st135.png)

- Initialize wifi server. After initialization, ESP32 and APP can communicate with each other through WIFI.

  ![img](./scratch_img/st142.png)

- Check whether wifi is connected to client/APP

  ![img](./scratch_img/st143.png)

- Send real time data of sensors to APP:	

  ![img](./scratch_img/st144.png)

- ESP32 receives data from APP and determine them. NOTE: All data are in the format of String.

  ![img](./scratch_img/st145.png)



##### Complete Code

![img](./scratch_img/st146.png)



--------



#### APP

###### APP Download

![img](./scratch_img/couapp1.png)

###### Android：

- Open Google play, and search IOT farm to download.

​	![img](./scratch_img/couapp2.png)

- In provided files, Android apk installing package is included:

  ![img](./scratch_img/cou123.png)

###### IOS：

Search **IOT farm** in APP Store and tap to download.



------



##### APP Interface

![img](./scratch_img/cou124.png)



------



##### APP Function Description

1. When your phone and ESP32 board connect to the same WIFI, you only need to input IP address at upper-right conner to link them. 

![img](./scratch_img/cou126.png)

2. Displays the temperature value of the farm in real time.

![img](./scratch_img/cou127.png)

3. Displays the humidity value of the farm in real time.

![img](./scratch_img/cou128.png)

4. Displays the soil humidity value of the farm in real time.

![img](./scratch_img/cou129.png)

5. Displays the sun brightness value of the farm in real time.

![img](./scratch_img/cou1210.png)

6. Displays the water level of the farm in real time.

![img](./scratch_img/cou1211.png)

7. Displays the analog rainfall value of the farm in real time.

![img](./scratch_img/cou1212.png)

8. Control LED.

![img](./scratch_img/cou1213.png)

9. Control irrigation via water pump.

![img](./scratch_img/cou1214.png)

10. Control the fan to adjust temperature.

![img](./scratch_img/cou1215.png)

11. Control servo to open or close feeding box.

![img](./scratch_img/cou1216.png)

12. Control buzzer to play music.

![img](./scratch_img/cou1217.png)



------



#### FAQ

##### Q: Wifi always fails to be connected.

A: Move ESP32 to the side of the router and reboot the board, and just be patient to wait. If it still fails to connected, please check whether the WiFi name and password are correct.

------

##### Q: APP fails to connect to ESP32.

A: Please make sure that APP and ESP32 are connected to the same WiFi.

------

##### Q: Fail to pump water?

A: Several pumping operations are required to fill the water pump before using it. These initial pumpings do not actually draw the water, but to introduce sufficient water into the pump. Only after the pump is full can water be carried out. So we are first for filling, not pumping.

------

------



## FAQ

### Q: What type of batteries should this kit be equipped with?

A: Six AA batteries, each one with the diameter of 14MM and height of 49MM. Please install batteries in a correct way and do not reverse them! For younger learners, please operate under the accompaniment of parents.

### Q: An error occurs when burning programs on ESP32 mainboard.

A:

- Please check whether the COM port is correct.
- Please check whether the selected board is correct.

### Q: Can this kit expands to other modules?

A: Yes. When expanding to other modules, please check pin description to make sure that ESP32 pins work normally.

### Q: An error occurs when importing <Wire.h> library.

A: When installing ESP32 development board on arduino IDE, <Wire.h> library will be imported automatically, so you don't need to add it repeatedly.

------

------

## **Resources**

Keyestudio official website: 

[https://www.keyestudio.com/](https://www.keyestudio.com/)

Keyestudio wiki main page:

[https://wiki.keyestudio.com/Main_Page](https://wiki.keyestudio.com/Main_Page)

ESP32 development board: 

[https://wiki.keyestudio.com/KS5016_Keyestudio_ESP32_PLUS_Development_Board](https://wiki.keyestudio.com/KS5016_Keyestudio_ESP32_PLUS_Development_Board)

Arduino official website: 

[https://www.arduino.cc/](https://www.arduino.cc/)

ESP32 espressif official website: 

[https://www.espressif.com/](https://www.espressif.com/)

